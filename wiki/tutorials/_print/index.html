<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.117.0"><link rel=canonical type=text/html href=https://purduearc.com/wiki/tutorials/><link rel=alternate type=application/rss+xml href=https://purduearc.com/wiki/tutorials/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Tutorials | Purdue ARC</title><meta name=description content="The Autonomous Robotics Club at Purdue"><meta property="og:title" content="Tutorials"><meta property="og:description" content="The Autonomous Robotics Club at Purdue"><meta property="og:type" content="website"><meta property="og:url" content="https://purduearc.com/wiki/tutorials/"><meta itemprop=name content="Tutorials"><meta itemprop=description content="The Autonomous Robotics Club at Purdue"><meta name=twitter:card content="summary"><meta name=twitter:title content="Tutorials"><meta name=twitter:description content="The Autonomous Robotics Club at Purdue"><link rel=preload href=/scss/main.min.7a18c54d67e65b6412582c3d8293061488d16e5146ad6d15c5ddf9bcb2001b0a.css as=style><link href=/scss/main.min.7a18c54d67e65b6412582c3d8293061488d16e5146ad6d15c5ddf9bcb2001b0a.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-00000000-0"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-00000000-0")}</script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Purdue ARC</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/about/><span>About</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/wiki/><span class=active>Wiki</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/blog/><span>Blog</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/join/><span>Join</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><div class=td-search><div class=td-search__icon></div><input type=search class="td-search__input form-control td-search-input" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/wiki/tutorials/>Return to the regular view of this page</a>.</p></div><h1 class=title>Tutorials</h1><ul><li>1: <a href=#pg-cc9e378c04a3b940d6834393964feba7>Project Management</a></li><li>2: <a href=#pg-a341352474c44c5268fa6c45ddc11cc9>WSL2</a></li><li>3: <a href=#pg-295fe67c251bd8e068f0ae59c2abc638>Snake Game</a></li><li>4: <a href=#pg-ecf70efeaa595e788a277309f4a76a9d>Using the Terminal</a></li><li>5: <a href=#pg-a1452db62844d68fbce1e24f7db842cf>X Forwarding</a></li><li>6: <a href=#pg-956c2caed651ad5914da7f6d7c2ff6fe>ROS</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-cc9e378c04a3b940d6834393964feba7>1 - Project Management</h1><div class=lead>Guide on managing a project within ARC</div><p>Managing an ARC-supported project can be a challenging, but rewarding experience. Throughout this journey, you will pick up on many skills and lessons which can be carried through the rest of your life. The uncertainty of what lies ahead prevents us from outlining every possible milestone, but here we intend to provide general action items for how to successfully carry out your project within ARC.</p><p>In general, a project manager&rsquo;s responsibilities can be broken into three categories:</p><ul><li>Development of project mission</li><li>Proposal of project resources</li><li>Guiding of project progress</li></ul><p>Let&rsquo;s breakdown the responsibilities associated with each category:</p><blockquote><p>TLDR list is included in the conclusion</p></blockquote><h2 id=development-of-project-mission>Development of project mission</h2><p>The fundamental component of a project is its mission. It serves to inform laypeople about the project&rsquo;s process and goal. The mission can also be considered the project&rsquo;s <a href=https://en.wikipedia.org/wiki/Elevator_pitch>elevator pitch</a>. If a project&rsquo;s mission cannot be condensed into 2-3 sentences, then you may want to consider structural revision.</p><p>When a new project is formed, the <strong>project manager is responsible for crafting this mission</strong>.</p><h2 id=proposal-of-project-resources>Proposal of project resources</h2><p>Resources are the fuel required to reach your project&rsquo;s mission. This encompasses any of the following units:</p><ul><li>Team size</li><li>Knowledge</li><li>Funding</li><li>Workspace</li><li>Equipment</li></ul><p>When a new project is formed, the <strong>project manager is responsible for drafting a budget of these resources</strong>. There is no special format for this budget, it just needs to acknowledge what you need to be successful.</p><p>The leadership team will review this budget before work takes place. If approved, it is the leadership team&rsquo;s responsibility to ensure these resources are provided.</p><p>One of the more challenging problems is <strong>connecting people to the required knowledge</strong>, also known as onboarding. This requires understanding the present distribution of your team&rsquo;s skills, identifying the gaps, then directing them to the proper resources. If you have any issues with this process, let the leadership team know.</p><p>After onboarding new members, the <strong>project manager is responsible for submitting a roster of current students and their basic information (e.g. grade, major)</strong>.</p><p>As a Purdue organization, <strong>funds must be verified with the leadership team before being used</strong>. So if you budgeted $100 for a new part, then later in the year you would need to double-check with leadership before making the payment.</p><p>Currently, our organization can only provide reimbursements. This means money held by Purdue ARC cannot be spent directly on purchases, only to reimburse the purchaser. So to buy the $100 part mentioned above: a student within the team would have to buy the part, then file for reimbursement. We are actively working on obtaining a <a href=https://www.purdue.edu/business/boso/resources/pCards.php>purchasing card</a>, which would change this process. If reimbursement is an issue, notify leadership and we will try our best to work something out.</p><h2 id=guiding-of-project-progress>Guiding of project progress</h2><p>Lastly, project managers have an expectation to oversee the team&rsquo;s progress throughout the semester. Within ARC, PM&rsquo;s have a unique opportunity to apply their own leadership styles and techniques. As a general recommendation, try not to get overly bogged-down by bizz-buzz-words. Focus on breaking down the project&rsquo;s mission into actionable items, then organizing the completion of those items.</p><p>To ensure projects are reaching their mission, it is <strong>expected check-ins are performed at ARC&rsquo;s weekly leadership meeting</strong>. While project managers aren&rsquo;t explicitly responsible for delivering the status updates, they should oversee that it gets done.</p><p>If the check-ins indicate some underlying issues, then the leadership team may request to meet with the project manager and discuss solutions.</p><p>At the end of each semester, <strong>project managers are responsible for organizing a presentation to cover their team&rsquo;s work</strong>. Again the PM doesn&rsquo;t single-handily write this presentation, just oversees its completion.</p><h2 id=conclusion>Conclusion</h2><p>If you made it this far, then you are one step closer to seeing your ideas come to life. Writing about project overhead is probably just as painful as reading it, but it&rsquo;s often a necessary evil to achieving results.</p><p>The following is a compiled list of the PM&rsquo;s responsibilities:</p><ul><li>Find the project&rsquo;s mission</li><li>Budget necessary resources</li><li>Onboard new members</li><li>Submit a team roster</li><li>Verify and reimburse purchases</li><li>Check-in with the leadership team weekly</li><li>Present project progress each semester</li></ul><p>The leadership team will explicitly state when these tasks need to be completed.</p><p>SAO provides <a href=https://www.purdue.edu/sao/resources/Resources%20for%20New%20Student%20Organizations.html>documentation</a> on the process of completing tasks such as scheduling rooms, submitting activity forms and more.</p><p>We understand lots of details in completing these tasks are vague, this is intentional. This offers freedom in how you choose to complete them. It cannot be overstated that if you have any questions, consult the leadership team.</p><p>Best of luck!</p></div><div class=td-content style=page-break-before:always><h1 id=pg-a341352474c44c5268fa6c45ddc11cc9>2 - WSL2</h1><div class=lead>Tutorial on Windows Subsystem for Linux</div><h2 id=introduction>Introduction</h2><p>Most development tools are built for Linux systems, which is why writing software on pure Windows isn&rsquo;t recommended.</p><p>To get around this, developers use WSL2 (Windows Subsystem for Linux version 2). Essentially, Windows is running a full Linux system in tandem with Windows. This has much better performance than running a virtual machine (VM) or using the original WSL.</p><p>This document will guide you through setting up WSL 2 on Windows 10 & 11.</p><h2 id=installation>Installation</h2><p>Microsoft has published an <a href=https://docs.microsoft.com/en-us/windows/wsl/install-win10>online guide</a>,
for setting up WSL2, which contains the most up-to-date information for installing
WSL2 on Windows. Follow the guide fully, and for step 6, install <a href=https://www.microsoft.com/store/apps/9n6svws3rx71>Ubuntu 20.04 LTS</a>.</p><p>Make sure to <a href=https://docs.microsoft.com/en-us/windows/wsl/user-support>set up a non-root user account</a>!</p><h2 id=windows-terminal>Windows Terminal</h2><p>While WSL2 does come with its own terminal, it isn&rsquo;t very aesthetic or functional. That&rsquo;s why we recommend installing <a href=https://aka.ms/terminal>Windows Terminal</a>. Once it is installed, launch it, then click the downwards arrow icon on the list of tabs. Select Ubuntu 20.04 from the dropdown, and you will be greeted with a bash terminal for your WSL2 instance.</p><p>If you&rsquo;d like to make the default behavior to open WSL2 tabs, you can hit the dropdown and select settings.</p><h2 id=visual-studio-code>Visual Studio Code</h2><p>When working in a larger project, you might find it a hassle to edit multiple files with vim or other CLI text editors. An alternative is Visual Studio Code, a text editor made by Microsoft to be lightweight and adaptable. With a few extensions, VS Code can be customized to work efficiently within ARC&rsquo;s development environment.</p><blockquote><p>Note: This isn&rsquo;t required for working within the ARC development environment. It&rsquo;s purely a tool that some may find useful.</p></blockquote><h3 id=installing-vs-code>Installing VS Code</h3><p>Available builds can be found <a href=https://code.visualstudio.com/>here</a>.</p><h3 id=extension-installation>Extension Installation</h3><p>After downloading and installing VS Code, open it to find a menu on the left hand side. Then click the icon containing stacked blocks, this is your extension menu. Here you can install applications to give VS Code more capabilities.</p><p>If you are running WSL2, you should start by installing the <a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-wsl">Remote - WSL</a> extension. You can use the search bar at the top to find it, then simply click install. If you aren&rsquo;t using WSL2, you can skip to installing the Python extension below.</p><p>After installing Remote WSL, you will need to reopen VS Code within your Ubuntu environment. You can do this by hitting <code>CTRL + SHIFT + P</code>, then typing:</p><pre tabindex=0><code>Remote-WSL: New Window
</code></pre><p>Hit enter and it should bring up a new VS Code window running on Ubuntu. You can go ahead and close the old VS Code instance. Return to the extension menu, then you should see a new section labeled: <em>WSL:Ubuntu - Installed</em></p><p>In order for any extensions to take place within WSL, you need to ensure that they are listed here.</p><p>Now we need to ensure that VS Code recognizes the primary language we use for developement, <a href="https://marketplace.visualstudio.com/items?itemName=ms-python.python">Python</a>. Which has it&rsquo;s own extension in the marketplace.</p><p>Next, you are going to want the <a href="https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-docker">Docker</a> extension. This will enable you to run ARC docker containers.</p><p>Lastly, it&rsquo;s recommended you get the <a href="https://marketplace.visualstudio.com/items?itemName=mhutchie.git-graph">Git Graph</a> extension. This isn&rsquo;t required, however it helps in any environment where you are utilizing git version control. Git Graph can visualize branches, merges, and commits to help organize your codebase.</p><h3 id=extension-usage>Extension Usage</h3><p>Now that you have the extensions installed, how do you use them?</p><p>We are already using the WSL extension, which you can verify by seeing a <em>WSL: Ubuntu</em> label in the bottom left corner (unless you are on Linux or Mac).</p><p>To open the console, enter:</p><pre tabindex=0><code>CTRL + SHIFT + ~
</code></pre><p>You can now run bash commands as per usual. If there is a file or folder you want to edit in VS Code, run:</p><pre tabindex=0><code>code (folder or file name)
</code></pre><p>For utilizing Docker in VS Code, click the Docker icon on the menu bar. Now you will be able to see all images and containers you are using. You should still use <code>docker-build.sh</code> and <code>docker-run.sh</code> scripts for running ARC containers, however this is a useful tool for managing versions.</p><p>If you intend on using VS Code, it might be helpful to check out their own <a href=https://code.visualstudio.com/docs/introvideos/basics>tutorials</a>.</p><h2 id=going-forward>Going Forward</h2><p>Now that WSL2 is setup, you&rsquo;ll want to setup <a href=x-forwarding>X forwarding</a> for running GUI applications. Additionally if you are unfamilar with bash, checkout our <a href=terminal>terminal guide</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-295fe67c251bd8e068f0ae59c2abc638>3 - Snake Game</h1><div class=lead>Snake game tutorial for learning ROS</div><h2 id=prerequisites>Prerequisites</h2><p>Before starting this tutorial, we recommend:</p><ul><li><a href=/wiki/tutorials/ros>Setting up your development environment</a></li></ul><h2 id=overview>Overview</h2><p>Before we dive into ROS, let&rsquo;s break down what we will be accomplishing.
Our end goal is to automate a game of Snake. If you have never heard of
Snake, then check out an example
<a href="https://www.google.com/search?client=firefox-b-1-d&amp;q=snake+game">here</a>.
We have made a ROS adaptation of it, which is what you will be automating.</p><p>There are two parts to this tutorial:</p><ul><li>Controller walkthrough: Here we will walk you through the
creation of your own snake-controller. This will teach the basics of
ROS and principles related to automation.</li><li>Controller expansion: By the end of the previous section, you will
have a simple but functional controller. To strengthen your ROS skills,
you will now look at improving the controller and seeing how high of
score your snake can get.</li></ul><h2 id=setup>Setup</h2><p>If you&rsquo;ve correctly setup your development environment, then you should have a <code>catkin_ws</code> folder with <code>src/arc_tutorials</code> a folder inside. Move into the <code>arc_tutorials</code> folder and run the docker container:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./arc_tutorials/docker/docker-run.sh
</span></span></code></pre></div><p>You should now be inside the container.</p><h2 id=verification>Verification</h2><p>Ensure your file structure matches the following:</p><pre tabindex=0><code>catkin_ws/ &lt;-- You should be here
│
└───src/
    │
    └───arc_tutorials/
       │
       └───clock_tutorial/ (deprecated tutorials)
       │
       └───docker/ (virtualization)
       │
       └───docs/ (setup instructions)
       │
       └───snake_tutorial/ (ROS tutorial)
       │
       └───snakesim/ (snake_tutorial backend)
</code></pre><p>We will explain the file structure in-depth later, so don&rsquo;t worry if it doesn&rsquo;t
make any sense now.</p><h2 id=instructions>Instructions</h2><p>To complete this tutorial, simply follow each provided documents in order. Ensure
you are reading thoroughly, as these tutorials are packed with tons of
information.</p><p>If you run into issues, start by doing independent research. If you haven&rsquo;t
found a solution after sufficiently making an attempt on your own, then add your question at the <a href=http://localhost:4000/wiki/tutorials/snake-tutorial#give-us-feedback>botttom of this page</a>.</p><h2 id=running-the-snake-tutorial-example>Running the Snake Tutorial Example</h2><p>In this section, we will be covering high-level ROS concepts and run the snake game example to see what we will be working towards.</p><h3 id=ros-concepts>ROS Concepts</h3><p>We discussed previously what ROS is, but now we are going to dive into
how ROS works.</p><p>In summary, ROS manages a system through 4 key components:</p><ul><li>Nodes: These are independent processes that perform computations. Nodes
often relate nicely to physical parts within a system, like a camera or an arm.</li><li>Messages: In order for different nodes to communicate, they need messages
to define the structure of the data they are sending. If a map node wanted
to tell a navigation node which way to move, it would have to use a message
(like a 3-point coordinate) to pass that data.</li><li>Topics: Messages help define the type of data we are sending, but topics
are what deliver the messages. Without topics, a node would never know
where to send it&rsquo;s messages. Nodes can either publish or subscribe to a
topic, which means they can either receive all messages
on that topic, send messages to that topic, or both.</li><li>Services: Topics are nice because it means nodes can send information
without worrying about if another node receives it. However sometimes it
may be necessary that a node receives a response from another before moving on.
This is where services come in; services allow for request / reply interactions.</li></ul><p>Here&rsquo;s a helpful visualization of node communication:</p><p><img src=assets/images/node-communication.png alt="Node communication"></p><p>As a supplementary resource / explanation, we recommend watching <a href="https://www.youtube.com/watch?v=bJB9tv4ThV4&amp;list=PLJNGprAk4DF5PY0kB866fEZfz6zMLJTF8&amp;index=2">this
video</a>
until 5 minutes and 53 seconds.</p><blockquote><p>If some of these concepts aren&rsquo;t yet clear, don&rsquo;t worry. Through the
walkthrough we will continue to strengthen our understanding.</p></blockquote><h3 id=snake-example>Snake Example</h3><p>Now let&rsquo;s try to apply some of the concepts we&rsquo;ve learned to the snake
game. We will start by running the <code>snakesim</code> package to see what we will
be controlling.</p><p>To verify that your workspace is correct, run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ls catkin_ws
</span></span></code></pre></div><p>If everything is correct, you should simply see a <code>src/</code> folder. Let&rsquo;s now
move into our workspace by running:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> catkin_ws
</span></span></code></pre></div><p>Now we need to build our workspace, which will setup our environment
to run packages. This will all be explained in the next section, so hang
in there. We do this with the command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>catkin build
</span></span></code></pre></div><p>Now if we print our directory contents again:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ls
</span></span></code></pre></div><p>We should see a few new folders, including a <code>devel/</code> folder which is
also important for configuring our environment.</p><p>Again this will be covered in the next section, so just run these
commands and it will make sense soon.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>source</span> devel/setup.bash
</span></span></code></pre></div><p>With our workspace and environment fully configured, we can now run the
packages we have stored.</p><p>Lets start by moving into our package directory:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> src/arc_tutorials
</span></span></code></pre></div><p>If we print our directory again with <code>ls</code>, we should see 5 folders:</p><ul><li><code>clock_tutorial/</code> a deprecated tutorial for ROS in C++</li><li><code>docker/</code> a set of tools to run ARC&rsquo;s docker environment</li><li><code>docs/</code> the collection of documents to follow this tutorial</li><li><code>snake_tutorial/</code> a ROS python package to teach basic control of the
snake game</li><li><code>snakesim/</code> a ROS python package to run the snake game</li></ul><p>In order to run the snake simulation, we will use what is known as a launch
file. It&rsquo;s not important for you to know how a launch file fully works at
the moment, but just know that it starts up ROS nodes in a set way so you
don&rsquo;t have to do it manually.</p><p>To run the launch file:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>roslaunch snakesim snakesim.launch
</span></span></code></pre></div><p>Upon running this, two windows should appear. One shows a display of the
snake game and another is a control board for the snake (this is what we
will be replacing). Here&rsquo;s what they look like:</p><p><img src=assets/images/snake-sim.PNG alt="Snake sim"> <img src=assets/images/snake-sim-control-board.PNG alt="Snake control board"></p><blockquote><p>If you get an error message saying <code>snakesim</code> is not a package, then
you need run: <code>source devel/setup.bash</code> in the <code>catkin_ws/</code> directory.</p></blockquote><blockquote><p>If you get an error message about failing to display, it&rsquo;s likely because X
forwarding is incorrectly setup. Return to
<a href=../../docs/03_arc-dev-env.md>setup tutorial #3</a> for more detail.</p></blockquote><p>To control the snake, you can either move it with WASD and shift keys or
manually adjust the speed with the scroll bars.
Play around with it and see how far you can get.</p><p>In this example, we are using only one node and that&rsquo;s to
control the position of the snake. Every time you adjust the speed, you
are sending messages on a topic that the snake node is receiving. These
messages adjust the snake&rsquo;s velocity so it knows what position to move to.</p><p>Lets now close both of those windows and use <code>CTRL + C</code> in the console
to exit the program. Next we are going to run the snake controller
example to see what we are building towards.</p><p>Again we will use a launch file:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>roslaunch snake_tutorial snake.launch
</span></span></code></pre></div><p>The snake game should appear again, but this time it should be
autonomously playing the game. If you watch it long enough, eventually
it will fail because its logic is very simple. By the end of this
tutorial, we will have built this same controller from the ground up.</p><h3 id=final-notes>Final Notes</h3><p>Congratulations, you just finished getting familiarized with the snake game
and the controller! You&rsquo;ll develop this same controller by following this
tutorial series. In the next step, you&rsquo;ll create a package to hold your
controller, then you&rsquo;ll write some nodes in order to control the snake.</p><h2 id=creating-the-controller-package>Creating the Controller Package</h2><p>Up to this point, we have explored high-level ROS concepts and ran the
Snake game example controller. We will now go through practical concepts
related to development within ROS.</p><h3 id=ros-file-structure>ROS File Structure</h3><p>Let&rsquo;s take a deeper dive into our project file structure.</p><p>Software in ROS is organized in <code>packages</code>. Packages contain our nodes,
launch files, messages, services and more. When working on a project, you may have multiple
packages all responsible for various tasks. For instance, <code>snakesim/</code> and
<code>snake_tutorial/</code> are both examples of packages.</p><p>Packages are often managed within a catkin workspace, which is what you
setup as part of your ARC development environment.</p><p>The simplified file structure for a workspace is as follows:</p><pre tabindex=0><code>catkin_ws/
│
└───src/
│   └───example_package/
│   └───another_package/
│
└───devel/
|   └─setup.bash
|
└───build/
|
└───logs/
|
└───install/
</code></pre><p><code>src/</code> is where the source code for all packages are stored. This commonly
contains repositories tracked by Git.</p><p><code>build/</code> and <code>logs/</code> are created when building your code. We won&rsquo;t go into any
detail on these.</p><p><code>devel/</code> and <code>install/</code> contain executables and bash files for setting up your
environment. It is optional to have an <code>install/</code> directory; we won&rsquo;t be using
one in this tutorial. There are a few distinctions between the two that we won&rsquo;t
get into.</p><p>Each time you open your workspace in a new terminal you will need to source this
setup file by running:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>source</span> devel/setup.bash
</span></span></code></pre></div><p>There is a way to do that automatically, which is covered at the end of this
document.</p><p>Here is a simplified file structure for Python ROS packages (C++ is different):</p><pre tabindex=0><code>example_package/
│
└───nodes/
│
└───launch/
│
└───CMakeLists.txt
│
└───package.xml
</code></pre><p><code>nodes/</code> contains node Python files for running ROS nodes. You&rsquo;ll end up making
several of these when following the tutorial.</p><p><code>launch/</code> contains launch files. These can launch one or more nodes and contain
logic.</p><p><code>CMakeLists.txt</code> is a build file used by your catkin workspace.</p><p><code>package.xml</code> is a manifest that contains general package information.</p><h3 id=creating-a-new-package>Creating a New Package</h3><p>We will start by moving into the <code>src/</code> directory of our
catkin workspace. As a reminder, you should still be within the container environment and
have the following file path:</p><p><code>~/catkin_ws/src/</code></p><p>Now we will use this command to create our new package:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>catkin_create_pkg snake_controller rospy geometry_msgs std_msgs snakesim tf python-angles
</span></span></code></pre></div><p>Looking at this command, <code>snake_controller</code> is the name of package and
all the parameters that follow are other packages that <code>snake_controller</code>
depends on. Don&rsquo;t worry about what those packages are right now, you&rsquo;ll learn
about them when completing the tutorials.</p><p>Lets now move into our newly created package:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> snake_controller/
</span></span></code></pre></div><p>Upon printing the directory contents, you can see have three items within
our package:</p><ul><li><code>CMakeLists.txt</code></li><li><code>package.xml</code></li><li><code>src/</code></li></ul><p>In order to make things better set up for a purely Python ROS package, we&rsquo;re
going to modify the <code>CMakeLists.txt</code> and <code>package.xml</code>. We will also be making
a few directories. If you aren&rsquo;t comfortable making directories on the
commandline, you can do these steps in an IDE like VS Code.</p><h3 id=modifying-packagexml>Modifying Package.xml</h3><p>The <code>package.xml</code> file exists to capture some basic information about your
package, such as the author, maintainer, license, and any dependencies that your
package has. If we open the existing one, you can see it has a lot of
information, and some comments about how to edit it:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;package</span> <span style=color:#c4a000>format=</span><span style=color:#4e9a06>&#34;2&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;name&gt;</span>snake_controller<span style=color:#204a87;font-weight:700>&lt;/name&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;version&gt;</span>0.0.0<span style=color:#204a87;font-weight:700>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;description&gt;</span>The snake_controller package<span style=color:#204a87;font-weight:700>&lt;/description&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- One maintainer tag required, multiple allowed, one person per tag --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- Example:  --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- &lt;maintainer email=&#34;jane.doe@example.com&#34;&gt;Jane Doe&lt;/maintainer&gt; --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;maintainer</span> <span style=color:#c4a000>email=</span><span style=color:#4e9a06>&#34;jamesb@todo.todo&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>jamesb<span style=color:#204a87;font-weight:700>&lt;/maintainer&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- One license tag required, multiple allowed, one license per tag --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- Commonly used license strings: --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!--   BSD, MIT, Boost Software License, GPLv2, GPLv3, LGPLv2.1, LGPLv3 --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;license&gt;</span>TODO<span style=color:#204a87;font-weight:700>&lt;/license&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- Url tags are optional, but multiple are allowed, one per tag --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- Optional attribute type can be: website, bugtracker, or repository --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- Example: --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- &lt;url type=&#34;website&#34;&gt;http://wiki.ros.org/snake_controller&lt;/url&gt; --&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- Author tags are optional, multiple are allowed, one per tag --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- Authors do not have to be maintainers, but could be --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- Example: --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- &lt;author email=&#34;jane.doe@example.com&#34;&gt;Jane Doe&lt;/author&gt; --&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- The *depend tags are used to specify dependencies --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- Dependencies can be catkin packages or system dependencies --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- Examples: --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- Use depend as a shortcut for packages that are both build and exec dependencies --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!--   &lt;depend&gt;roscpp&lt;/depend&gt; --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!--   Note that this is equivalent to the following: --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!--   &lt;build_depend&gt;roscpp&lt;/build_depend&gt; --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!--   &lt;exec_depend&gt;roscpp&lt;/exec_depend&gt; --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- Use build_depend for packages you need at compile time: --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!--   &lt;build_depend&gt;message_generation&lt;/build_depend&gt; --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- Use build_export_depend for packages you need in order to build against this package: --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!--   &lt;build_export_depend&gt;message_generation&lt;/build_export_depend&gt; --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- Use buildtool_depend for build tool packages: --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!--   &lt;buildtool_depend&gt;catkin&lt;/buildtool_depend&gt; --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- Use exec_depend for packages you need at runtime: --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!--   &lt;exec_depend&gt;message_runtime&lt;/exec_depend&gt; --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- Use test_depend for packages you need only for testing: --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!--   &lt;test_depend&gt;gtest&lt;/test_depend&gt; --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- Use doc_depend for packages you need only for building documentation: --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!--   &lt;doc_depend&gt;doxygen&lt;/doc_depend&gt; --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;buildtool_depend&gt;</span>catkin<span style=color:#204a87;font-weight:700>&lt;/buildtool_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;build_depend&gt;</span>geometry_msgs<span style=color:#204a87;font-weight:700>&lt;/build_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;build_depend&gt;</span>python-angles<span style=color:#204a87;font-weight:700>&lt;/build_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;build_depend&gt;</span>rospy<span style=color:#204a87;font-weight:700>&lt;/build_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;build_depend&gt;</span>snakesim<span style=color:#204a87;font-weight:700>&lt;/build_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;build_depend&gt;</span>std_msgs<span style=color:#204a87;font-weight:700>&lt;/build_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;build_depend&gt;</span>tf<span style=color:#204a87;font-weight:700>&lt;/build_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;build_export_depend&gt;</span>geometry_msgs<span style=color:#204a87;font-weight:700>&lt;/build_export_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;build_export_depend&gt;</span>python-angles<span style=color:#204a87;font-weight:700>&lt;/build_export_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;build_export_depend&gt;</span>rospy<span style=color:#204a87;font-weight:700>&lt;/build_export_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;build_export_depend&gt;</span>snakesim<span style=color:#204a87;font-weight:700>&lt;/build_export_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;build_export_depend&gt;</span>std_msgs<span style=color:#204a87;font-weight:700>&lt;/build_export_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;build_export_depend&gt;</span>tf<span style=color:#204a87;font-weight:700>&lt;/build_export_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;exec_depend&gt;</span>geometry_msgs<span style=color:#204a87;font-weight:700>&lt;/exec_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;exec_depend&gt;</span>python-angles<span style=color:#204a87;font-weight:700>&lt;/exec_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;exec_depend&gt;</span>rospy<span style=color:#204a87;font-weight:700>&lt;/exec_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;exec_depend&gt;</span>snakesim<span style=color:#204a87;font-weight:700>&lt;/exec_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;exec_depend&gt;</span>std_msgs<span style=color:#204a87;font-weight:700>&lt;/exec_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;exec_depend&gt;</span>tf<span style=color:#204a87;font-weight:700>&lt;/exec_depend&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- The export tag contains other, unspecified, tags --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;export&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>&lt;!-- Other tools can request additional information be placed here --&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;/export&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/package&gt;</span>
</span></span></code></pre></div><p>We&rsquo;re going to go ahead and remove a lot of the stuff that we don&rsquo;t need:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;package</span> <span style=color:#c4a000>format=</span><span style=color:#4e9a06>&#34;2&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;name&gt;</span>snake_controller<span style=color:#204a87;font-weight:700>&lt;/name&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;version&gt;</span>0.0.0<span style=color:#204a87;font-weight:700>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;description&gt;</span>The snake_controller package<span style=color:#204a87;font-weight:700>&lt;/description&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- One maintainer tag required, multiple allowed, one person per tag --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- Example:  --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- &lt;maintainer email=&#34;jane.doe@example.com&#34;&gt;Jane Doe&lt;/maintainer&gt; --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;maintainer</span> <span style=color:#c4a000>email=</span><span style=color:#4e9a06>&#34;jamesb@todo.todo&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>jamesb<span style=color:#204a87;font-weight:700>&lt;/maintainer&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- One license tag required, multiple allowed, one license per tag --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- Commonly used license strings: --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!--   BSD, MIT, Boost Software License, GPLv2, GPLv3, LGPLv2.1, LGPLv3 --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;license&gt;</span>TODO<span style=color:#204a87;font-weight:700>&lt;/license&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- Author tags are optional, multiple are allowed, one per tag --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- Authors do not have to be maintainers, but could be --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- Example: --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>&lt;!-- &lt;author email=&#34;jane.doe@example.com&#34;&gt;Jane Doe&lt;/author&gt; --&gt;</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;buildtool_depend&gt;</span>catkin<span style=color:#204a87;font-weight:700>&lt;/buildtool_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;exec_depend&gt;</span>geometry_msgs<span style=color:#204a87;font-weight:700>&lt;/exec_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;exec_depend&gt;</span>python-angles<span style=color:#204a87;font-weight:700>&lt;/exec_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;exec_depend&gt;</span>rospy<span style=color:#204a87;font-weight:700>&lt;/exec_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;exec_depend&gt;</span>snakesim<span style=color:#204a87;font-weight:700>&lt;/exec_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;exec_depend&gt;</span>std_msgs<span style=color:#204a87;font-weight:700>&lt;/exec_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;exec_depend&gt;</span>tf<span style=color:#204a87;font-weight:700>&lt;/exec_depend&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/package&gt;</span>
</span></span></code></pre></div><p>Go ahead and make a few changes to personalize it:</p><ul><li>add a version number if you want</li><li>add yourself as the maintainer</li><li>add a license if you want</li><li>add yourself as an author</li></ul><p>You should end up with something like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;package</span> <span style=color:#c4a000>format=</span><span style=color:#4e9a06>&#34;2&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;name&gt;</span>snake_controller<span style=color:#204a87;font-weight:700>&lt;/name&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;version&gt;</span>1.0.0<span style=color:#204a87;font-weight:700>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;description&gt;</span>A basic controller for the snakesim package<span style=color:#204a87;font-weight:700>&lt;/description&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;maintainer</span> <span style=color:#c4a000>email=</span><span style=color:#4e9a06>&#34;pete@purdue.edu&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>Purdue Pete<span style=color:#204a87;font-weight:700>&lt;/maintainer&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;license&gt;</span>BSD 3 Clause<span style=color:#204a87;font-weight:700>&lt;/license&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;author</span> <span style=color:#c4a000>email=</span><span style=color:#4e9a06>&#34;pete@purdue.edu&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>Purdue Pete<span style=color:#204a87;font-weight:700>&lt;/author&gt;</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;buildtool_depend&gt;</span>catkin<span style=color:#204a87;font-weight:700>&lt;/buildtool_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;exec_depend&gt;</span>geometry_msgs<span style=color:#204a87;font-weight:700>&lt;/exec_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;exec_depend&gt;</span>python-angles<span style=color:#204a87;font-weight:700>&lt;/exec_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;exec_depend&gt;</span>rospy<span style=color:#204a87;font-weight:700>&lt;/exec_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;exec_depend&gt;</span>snakesim<span style=color:#204a87;font-weight:700>&lt;/exec_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;exec_depend&gt;</span>std_msgs<span style=color:#204a87;font-weight:700>&lt;/exec_depend&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;exec_depend&gt;</span>tf<span style=color:#204a87;font-weight:700>&lt;/exec_depend&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/package&gt;</span>
</span></span></code></pre></div><h3 id=modifying-cmakeliststxt>Modifying CMakeLists.txt</h3><p>The <code>CMakeLists.txt</code> is similar to <code>package.xml</code> in that it contains a lot of
templated information for you to go in and edit. For a C++ package, it is very
important, rather complicated, and will be used to build the code. For a purely
Python package, it is actually really simple. It is only needed to make your
code compatible with the catkin build system.</p><p>If you open the existing one, you should see something like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmake data-lang=cmake><span style=display:flex><span><span style=color:#204a87>cmake_minimum_required</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>VERSION</span> <span style=color:#4e9a06>3.0.2</span><span style=color:#000;font-weight:700>)</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87>project</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>snake_controller</span><span style=color:#000;font-weight:700>)</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>## Compile as C++11, supported in ROS Kinetic and newer
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># add_compile_options(-std=c++11)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>## Find catkin macros and libraries
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## if COMPONENTS list like find_package(catkin REQUIRED COMPONENTS xyz)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## is used, also find other catkin packages
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87>find_package</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>catkin</span> <span style=color:#4e9a06>REQUIRED</span> <span style=color:#4e9a06>COMPONENTS</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>geometry_msgs</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>python-angles</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>rospy</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>snakesim</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>std_msgs</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>tf</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>## System dependencies are found with CMake&#39;s conventions
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># find_package(Boost REQUIRED COMPONENTS system)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>## Uncomment this if the package has a setup.py. This macro ensures
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## modules and global scripts declared therein get installed
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## See http://ros.org/doc/api/catkin/html/user_guide/setup_dot_py.html
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># catkin_python_setup()
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>################################################
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## Declare ROS messages, services and actions ##
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>################################################
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>## To declare and build messages, services or actions from within this
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## package, follow these steps:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## * Let MSG_DEP_SET be the set of packages whose message types you use in
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>##   your messages/services/actions (e.g. std_msgs, actionlib_msgs, ...).
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## * In the file package.xml:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>##   * add a build_depend tag for &#34;message_generation&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>##   * add a build_depend and a exec_depend tag for each package in MSG_DEP_SET
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>##   * If MSG_DEP_SET isn&#39;t empty the following dependency has been pulled in
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>##     but can be declared for certainty nonetheless:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>##     * add a exec_depend tag for &#34;message_runtime&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## * In this file (CMakeLists.txt):
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>##   * add &#34;message_generation&#34; and every package in MSG_DEP_SET to
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>##     find_package(catkin REQUIRED COMPONENTS ...)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>##   * add &#34;message_runtime&#34; and every package in MSG_DEP_SET to
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>##     catkin_package(CATKIN_DEPENDS ...)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>##   * uncomment the add_*_files sections below as needed
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>##     and list every .msg/.srv/.action file to be processed
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>##   * uncomment the generate_messages entry below
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>##   * add every package in MSG_DEP_SET to generate_messages(DEPENDENCIES ...)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>## Generate messages in the &#39;msg&#39; folder
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># add_message_files(
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   FILES
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   Message1.msg
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   Message2.msg
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># )
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>## Generate services in the &#39;srv&#39; folder
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># add_service_files(
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   FILES
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   Service1.srv
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   Service2.srv
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># )
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>## Generate actions in the &#39;action&#39; folder
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># add_action_files(
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   FILES
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   Action1.action
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   Action2.action
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># )
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>## Generate added messages and services with any dependencies listed here
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># generate_messages(
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   DEPENDENCIES
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   geometry_msgs#   std_msgs
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># )
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>################################################
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## Declare ROS dynamic reconfigure parameters ##
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>################################################
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>## To declare and build dynamic reconfigure parameters within this
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## package, follow these steps:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## * In the file package.xml:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>##   * add a build_depend and a exec_depend tag for &#34;dynamic_reconfigure&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## * In this file (CMakeLists.txt):
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>##   * add &#34;dynamic_reconfigure&#34; to
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>##     find_package(catkin REQUIRED COMPONENTS ...)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>##   * uncomment the &#34;generate_dynamic_reconfigure_options&#34; section below
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>##     and list every .cfg file to be processed
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>## Generate dynamic reconfigure parameters in the &#39;cfg&#39; folder
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># generate_dynamic_reconfigure_options(
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   cfg/DynReconf1.cfg
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   cfg/DynReconf2.cfg
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># )
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>###################################
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## catkin specific configuration ##
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>###################################
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## The catkin_package macro generates cmake config files for your package
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## Declare things to be passed to dependent projects
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## INCLUDE_DIRS: uncomment this if your package contains header files
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## LIBRARIES: libraries you create in this project that dependent projects also need
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## CATKIN_DEPENDS: catkin_packages dependent projects also need
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## DEPENDS: system dependencies of this project that dependent projects also need
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87>catkin_package</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#  INCLUDE_DIRS include
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#  LIBRARIES snake_controller
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#  CATKIN_DEPENDS geometry_msgs python-angles rospy snakesim std_msgs tf
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#  DEPENDS system_lib
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>)</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>###########
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## Build ##
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>###########
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>## Specify additional locations of header files
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## Your package locations should be listed before other locations
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87>include_directories</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># include
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#ce5c00;font-weight:700>${</span><span style=color:#000>catkin_INCLUDE_DIRS</span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>## Declare a C++ library
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># add_library(${PROJECT_NAME}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   src/${PROJECT_NAME}/snake_controller.cpp
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># )
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>## Add cmake target dependencies of the library
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## as an example, code may need to be generated before libraries
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## either from message generation or dynamic reconfigure
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># add_dependencies(${PROJECT_NAME} ${${PROJECT_NAME}_EXPORTED_TARGETS} ${catkin_EXPORTED_TARGETS})
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>## Declare a C++ executable
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## With catkin_make all packages are built within a single CMake context
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## The recommended prefix ensures that target names across packages don&#39;t collide
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># add_executable(${PROJECT_NAME}_node src/snake_controller_node.cpp)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>## Rename C++ executable without prefix
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## The above recommended prefix causes long target names, the following renames the
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## target back to the shorter version for ease of user use
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## e.g. &#34;rosrun someones_pkg node&#34; instead of &#34;rosrun someones_pkg someones_pkg_node&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># set_target_properties(${PROJECT_NAME}_node PROPERTIES OUTPUT_NAME node PREFIX &#34;&#34;)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>## Add cmake target dependencies of the executable
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## same as for the library above
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># add_dependencies(${PROJECT_NAME}_node ${${PROJECT_NAME}_EXPORTED_TARGETS} ${catkin_EXPORTED_TARGETS})
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>## Specify libraries to link a library or executable target against
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># target_link_libraries(${PROJECT_NAME}_node
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   ${catkin_LIBRARIES}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># )
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>#############
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## Install ##
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#############
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic># all install targets should use catkin DESTINATION variables
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># See http://ros.org/doc/api/catkin/html/adv_user_guide/variables.html
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>## Mark executable scripts (Python etc.) for installation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## in contrast to setup.py, you can choose the destination
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># catkin_install_python(PROGRAMS
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   scripts/my_python_script
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   DESTINATION ${CATKIN_PACKAGE_BIN_DESTINATION}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># )
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>## Mark executables for installation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## See http://docs.ros.org/melodic/api/catkin/html/howto/format1/building_executables.html
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># install(TARGETS ${PROJECT_NAME}_node
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   RUNTIME DESTINATION ${CATKIN_PACKAGE_BIN_DESTINATION}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># )
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>## Mark libraries for installation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## See http://docs.ros.org/melodic/api/catkin/html/howto/format1/building_libraries.html
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># install(TARGETS ${PROJECT_NAME}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   ARCHIVE DESTINATION ${CATKIN_PACKAGE_LIB_DESTINATION}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   LIBRARY DESTINATION ${CATKIN_PACKAGE_LIB_DESTINATION}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   RUNTIME DESTINATION ${CATKIN_GLOBAL_BIN_DESTINATION}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># )
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>## Mark cpp header files for installation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># install(DIRECTORY include/${PROJECT_NAME}/
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   DESTINATION ${CATKIN_PACKAGE_INCLUDE_DESTINATION}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   FILES_MATCHING PATTERN &#34;*.h&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   PATTERN &#34;.svn&#34; EXCLUDE
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># )
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>## Mark other files for installation (e.g. launch and bag files, etc.)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># install(FILES
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   # myfile1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   # myfile2
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   DESTINATION ${CATKIN_PACKAGE_SHARE_DESTINATION}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># )
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>#############
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## Testing ##
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#############
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>## Add gtest based cpp test target and link libraries
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># catkin_add_gtest(${PROJECT_NAME}-test test/test_snake_controller.cpp)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># if(TARGET ${PROJECT_NAME}-test)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   target_link_libraries(${PROJECT_NAME}-test ${PROJECT_NAME})
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># endif()
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>## Add folders to be run by python nosetests
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># catkin_add_nosetests(test)
</span></span></span></code></pre></div><p>Once we remove everything we don&rsquo;t need, it is pretty short:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmake data-lang=cmake><span style=display:flex><span><span style=color:#204a87>cmake_minimum_required</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>VERSION</span> <span style=color:#4e9a06>3.0.2</span><span style=color:#000;font-weight:700>)</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87>project</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>snake_controller</span><span style=color:#000;font-weight:700>)</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic># Find catkin macros
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87>find_package</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>catkin</span> <span style=color:#4e9a06>REQUIRED</span><span style=color:#000;font-weight:700>)</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic># generates cmake config files and set variables for installation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87>catkin_package</span><span style=color:#000;font-weight:700>()</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Optionally, you can leave the install and test section in there, but we won&rsquo;t be
using it for this tutorial.</p><h3 id=creating-the-package-directory-structure>Creating the Package Directory Structure</h3><p>We&rsquo;re going to remove the existing <code>src/</code> directory, which is commonly used for
C++ code or Python modules (we are making Python nodes, which are different).</p><p>Instead, make the directory structure that we talked about earlier:</p><pre tabindex=0><code>snake_controller/
│
└───nodes/
│
└───launch/
│
└───CMakeLists.txt
│
└───package.xml
</code></pre><h3 id=sourcing-the-workspace-automatically>Sourcing the Workspace Automatically</h3><p>Remember how we said that you need to source the workspace for every new
terminal window that you open? The command looks like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>source</span> devel/setup.bash
</span></span></code></pre></div><p>Thankfully, there is a way to make that happen automatically by modifying a script called the <code>bashrc</code>.
This is a script that is run every time you open a new terminal. If we put that
source command at the end of it, then we don&rsquo;t need to worry about running it
manually for every new terminal we open. You can add that command by running
the following in your shell:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;source ~/catkin_ws/devel/setup.bash&#39;</span> &gt;&gt; ~/.bashrc
</span></span></code></pre></div><p>We can now run that to make it take effect in our current terminal:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>source</span> ~/.bashrc
</span></span></code></pre></div><h3 id=final-notes-1>Final Notes</h3><p>Congratulations, you just finished creating a ROS package! In the following
documents, we&rsquo;ll build three nodes that will allow your new package to control
the snake game that you ran earlier.</p><h2 id=heading-controller>Heading Controller</h2><h3 id=overview-1>Overview</h3><p>Since our snake recieves linear and angular velocity inputs, making a heading
controller seems like a good place to start. This will allow us to control the
heading of the snake using feedback control.</p><p>Feedback control (also called closed-loop control) means that we are using
sensor readings (in this case the output pose of the snake) in order to create
our control signal that we send to the snake. As a block diagram, it may look
like this:</p><p><img src=assets/images/heading-controller.png alt="heading controller"></p><p>This node is also going to handle the linear velocity command too. We&rsquo;re just
going to keep that at a constant value in order to keep things simple.</p><h3 id=creating-the-program>Creating the Program</h3><p>Let&rsquo;s go ahead and implement this controller in Python now.</p><p>We need to start by creating a new file. In the last tutorial, we were left with
the proper directory structure to start writing code. We need to make a new file
in the <code>nodes</code> directory to house our code. We&rsquo;ll call this file
<code>snake_heading_controller</code>.</p><p>Note that it is general practice not to add a <code>.py</code> file extension to nodes.
This is because the file name becomes the name of the node when building our
package with catkin. Ex: <code>rosrun snake_controller snake_heading_controller</code>
is cleaner than <code>rosrun snake_controller snake_heading_controller.py</code>.</p><p>Next, we need to make this file an executable:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chmod +x snake_heading_controller
</span></span></code></pre></div><p>You will need to do this for every node you create.</p><p>Let&rsquo;s start the file by writing a shebang and docstring.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;Node to control the heading of the snake.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>License removed for brevity
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;</span>
</span></span></code></pre></div><p>A shebang is a one line comment at the start of the file that tells the
computer how to run it. We will always use <code>#!/usr/bin/env python</code> for Python
files. You can read more about them <a href=https://en.wikipedia.org/wiki/Shebang_(Unix)>here</a></p><p>A docstring is a comment in triple double quotes (<code>"""</code>) that serves as a
comment for that file, class, function, or method. They are part of the PEP 8
style guide for Python, which we&rsquo;ll be following for our Python code. You can
read more about docstrings <a href=https://www.python.org/dev/peps/pep-0257/#what-is-a-docstring>here</a>,
and more about PEP 8 <a href=https://www.python.org/dev/peps/pep-0008/#introduction>here</a>.</p><p>Now, let&rsquo;s move on and start laying the foundation for our file by writing our
<code>__main__</code> check and creating a class to hold our logic.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>SnakeHeadingController</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>object</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;&#34;&#34;Simple heading controller for the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>__init__</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;__main__&#34;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#000>SnakeHeadingController</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>What we&rsquo;ve done in the first part of this program is create a class called
<code>SnakeHeadingController</code>. A class lets you group methods and variables together
inside an object. It is a key part of Object Oriented Programming (OOP). It is
useful for us, because we&rsquo;re going to have several variables holding data that
we&rsquo;ll need to access from different methods.</p><p>This class has a docstring like before, and it only has one method defined,
<code>__init__</code>. This function is called when you create a new instance of that class
and is used for initialization. Right now, we&rsquo;ve put <code>pass</code> inside, which is a
Python keyword meaning &ldquo;do nothing.&rdquo; It is a handy placeholder because leaving
the body of that function blank would result in an error.</p><p>In the second part of the program, we&rsquo;ve told the program what to do if it is
executed. The variable <code>__name__</code> is set to <code>__main__</code> if this file is the main
one being executed. If this file is included in another through <code>import</code>, then
the following statements do not get run. We will call this the &ldquo;<code>__main__</code>
check&rdquo; moving forward. This is the first part of the program that will be
executing commands once ROS starts the node. In this case, it is creating an
instance of our <code>SnakeHeadingController</code> class and doing nothing else.</p><p>If you&rsquo;d like, you can run this piece of code from your terminal with the
command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./snake_heading_controller
</span></span></code></pre></div><blockquote><p>this command works because of the shebang :)</p></blockquote><p>A keen observer will notice that nothing happened, and our program ended
immediately. This is because our code doesn&rsquo;t do anything yet. We call the
second part of our code, which creates an instance of a <code>SnakeHeadingController</code>,
which gets initialized through the <code>__init__</code> method, which does nothing. You
can put in print commands in various locations if you are confused about the
order in which that all happens:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87>print</span> <span style=color:#4e9a06>&#34;I am here #1&#34;</span>
</span></span></code></pre></div><h3 id=creating-the-node>Creating the Node</h3><p>Let&rsquo;s start our ROS specific setup now.</p><p>Let&rsquo;s modify the body of the <code>__init__</code> function to be the following. This is
replacing the <code>pass</code> keyword.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>init_node</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake_heading_controller&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>spin</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>Very importantly, we also need to tell Python to import the <code>rospy</code> module, so
that we have access to these functions. Add the following just below the
docstring:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>rospy</span>
</span></span></code></pre></div><p>An import command lets you pull in functionality from other Python files. This
is super useful to be able to re-use code and write small, modular files. If you
look at the source of the <code>snakesim</code> package, you will see it is full of imports.</p><p>Here is our current file for reference:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;Node to control the heading of the snake.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>License removed for brevity
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>rospy</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>SnakeHeadingController</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>object</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;&#34;&#34;Simple heading controller for the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>__init__</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>init_node</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake_heading_controller&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>spin</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;__main__&#34;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#000>SnakeHeadingController</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>Let&rsquo;s run the program again to see what happens. Note that the commands are a
little bit more involved since we need the ROS core to be running.</p><p>Terminal 1:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>roscore
</span></span></code></pre></div><p>Terminal 2:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./snake_heading_controller
</span></span></code></pre></div><p>Compared to the first time we ran this program, it may not seem like much has
changed. However, notice that the program will run forever. We need to manually
kill it with <code>ctrl+C</code>. This is due to the <code>spin</code> command. Essentially, this
command tells the node to wait indefinitely and process message subscriptions.
We don&rsquo;t have any current subscriptions, so the program isn&rsquo;t doing anything.</p><p>We can see the effect of the <code>init_node</code> command by running this in a third
terminal:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rosnode list
</span></span></code></pre></div><p>You will see your node, <code>snake_heading_controller</code> in the list of running nodes!</p><p>Feel free to try changing the name of the node or removing the <code>spin</code> command
to see what it does.</p><h3 id=creating-subscriptions>Creating Subscriptions</h3><p>In the last section, we learned that <code>spin</code> tells the program to wait
indefinitely and process message subscriptions. Let&rsquo;s create some of those
subscriptions now.</p><p>Before our <code>spin</code> command, add the following lines:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Subscribers</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Subscriber</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake/pose&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PoseArray</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>pose_cb</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Subscriber</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;controller/heading&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Float64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_cb</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>The <code>Subscriber</code> command tells ROS to subscribe to a topic (argument 1), of a
specific type (argument 2), and call a function (argument 3) when it recieves a
new message. We need to define those callback functions now.</p><p>Put these lines after <code>__init__</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>heading_cb</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>heading_msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;Callback for heading goal.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>pose_cb</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>pose_msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;Callback for poses from the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>pass</span>
</span></span></code></pre></div><p>We are defining methods for our <code>SnakeHeadingController</code> and simply using <code>pass</code>
so that we can hold off on the implementation for them. If you remember our
block diagram from earlier, we are subscribing to the desired heading and true
heading respectively.</p><p>The callbacks have one argument each (ignoring <code>self</code>), which is the contents of
the ROS message recieved. We&rsquo;ll talk more about how to interpret those shortly.</p><p>Lastly, we need to tell Python where to find these message types. Put this right
after our existing <code>import</code> command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>geometry_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>PoseArray</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>std_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Float64</span>
</span></span></code></pre></div><p>Here is our current file for reference:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;Node to control the heading of the snake.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>License removed for brevity
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>rospy</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>geometry_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>PoseArray</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>std_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Float64</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>SnakeHeadingController</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>object</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;&#34;&#34;Simple heading controller for the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>__init__</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>init_node</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake_heading_controller&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Subscribers</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Subscriber</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake/pose&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PoseArray</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>pose_cb</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Subscriber</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;controller/heading&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Float64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_cb</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>spin</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>heading_cb</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>heading_msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;Callback for heading goal.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>pose_cb</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>pose_msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;Callback for poses from the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;__main__&#34;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#000>SnakeHeadingController</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>If we run the file now, we should see the two new callbacks. We&rsquo;ll use the same
first two commands, but we&rsquo;ll use a slightly different third command in order
to inspect the node.</p><p>Terminal 1:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>roscore
</span></span></code></pre></div><p>Terminal 2:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./snake_heading_controller
</span></span></code></pre></div><p>Terminal 3:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rosnode info snake_heading_controller
</span></span></code></pre></div><p>You will see it is subscribed to <code>snake/pose</code> and <code>controller/heading</code> like we
intended!</p><h3 id=creating-publishers>Creating Publishers</h3><p>Thinking back to our block diagram, our program needs to output the commanded
linear velocity. We will need a publisher in order to do this.</p><p>Put this by the subscribers code. It can go before or after, but I like to put
them before.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Publishers</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>twist_pub</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Publisher</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake/cmd_vel&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Twist</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>queue_size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>This <code>Publisher</code> command is similar to the <code>Subscriber</code> command. It will create
a ROS publisher on a given topic (argument 1), of a given type (argument 2),
with a specific queue size (argument 3). A queue size of 1 means that the most
recent message will always be sent and any older messages waiting to be sent
will get dropped. This is good for our application, since we don&rsquo;t want a delay
caused by old messages stuck in a buffer. You can read more about queue sizes
on the <a href=http://wiki.ros.org/rospy/Overview/Publishers%20and%20Subscribers#queue_size:_publish.28.29_behavior_and_queuing>ROS wiki</a>.</p><p>Another difference is that we are keeping a reference to the <code>Publisher</code> object.
This is important so that we can publish messages via that reference in the
future.</p><p>Again, we need to tell Python where to find this new message type. Replace the
existing <code>PoseArray</code> import command with the following:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>geometry_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Twist</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PoseArray</span>
</span></span></code></pre></div><p>Here is our current file for reference:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;Node to control the heading of the snake.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>License removed for brevity
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>rospy</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>geometry_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Twist</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PoseArray</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>std_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Float64</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>SnakeHeadingController</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>object</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;&#34;&#34;Simple heading controller for the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>__init__</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>init_node</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake_heading_controller&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Publishers</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>twist_pub</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Publisher</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake/cmd_vel&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Twist</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>queue_size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Subscribers</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Subscriber</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake/pose&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PoseArray</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>pose_cb</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Subscriber</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;controller/heading&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Float64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_cb</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>spin</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>heading_cb</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>heading_msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;Callback for heading goal.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>pose_cb</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>pose_msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;Callback for poses from the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;__main__&#34;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#000>SnakeHeadingController</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>We can test with the same commands as earlier:</p><p>Terminal 1:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>roscore
</span></span></code></pre></div><p>Terminal 2:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./snake_heading_controller
</span></span></code></pre></div><p>Terminal 3:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rosnode info snake_heading_controller
</span></span></code></pre></div><p>You will see it is now publishing to <code>snake/cmd_vel</code> as we hoped!</p><h3 id=dealing-with-ros-message-definitions>Dealing with ROS Message Definitions</h3><p>Let&rsquo;s quickly talk about how to pull data out of the ROS messages that our
callbacks are recieving. The first thing you&rsquo;ll want to do is determine the
layout of the message you&rsquo;re receiving. This can be done by browsing the API
online or with a terminal command.</p><p>Online:</p><ul><li><a href=http://docs.ros.org/api/std_msgs/html/msg/Float64.html>std_msgs/Float64</a></li><li><a href=http://docs.ros.org/api/geometry_msgs/html/msg/PoseArray.html>geometry_msgs/PoseArray</a></li></ul><p>Terminal:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rosmsg info std_msgs/Float64
</span></span><span style=display:flex><span>rosmsg info geometry_msgs/PoseArray
</span></span></code></pre></div><p>Note that message definitions can be nested. Our <code>PoseArray</code> message holds an
array of <code>Pose</code> messages, which is a different message type you can also find
on the <a href=http://docs.ros.org/api/geometry_msgs/html/msg/Pose.html>online API</a>.</p><p>Let&rsquo;s look at the heading callback (<code>heading_cb</code>) first since it has a simpler
message. There is only one field, <code>data</code>, which holds a 64 bit floating point
number. This is the same as a <code>float</code> type for most Python implementations.</p><p>We&rsquo;ll save that to a local variable and figure out what to do with it later.
Replace <code>pass</code> with the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>heading_command</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>heading_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>data</span>
</span></span></code></pre></div><p>Let&rsquo;s look at the pose callback (<code>pose_cb</code>) now. You can see that it contains an
array of <code>Poses</code>. From the <code>README.md</code> file included in the <code>snakesim</code> package,
we know that this is an array with the pose of each element of the snake
starting at the head. We are only interested in the heading of the first
segment, which corresponds to the yaw of the pose at index 0.</p><p>We know we&rsquo;ll be looking at something like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>orientation</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span>
</span></span></code></pre></div><p>To make things a little bit trickier, this orientation is encoded as a
quaternion, not an Euler angle. There are many good reasons ROS uses quaternions
instead of Euler angles. It avoids singularities, is compact, and there is no
ambiguity about what convention is in use. For humans though, Euler angles are
normally easier to understand, so we&rsquo;ll convert to them with the help of a
module included with ROS.</p><p>First, we&rsquo;ll import the module. Put this with your other <code>import</code> commands:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>tf.transformations</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>euler_from_quaternion</span>
</span></span></code></pre></div><p>You can read the documentation on this function <a href=http://docs.ros.org/melodic/api/tf/html/python/transformations.html#tf.transformations.euler_from_quaternion>online</a>.</p><p>Next, we need to put the quaternion data into a tuple in (x,y,z,w) order, then
call the function to get the Euler angles as a tuple in (roll, pitch, yaw)
order. Replace <code>pass</code> with the following:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>            <span style=color:#000>quat</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>y</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>z</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>w</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#000>__</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>__</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>heading</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>euler_from_quaternion</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>quat</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>Here is our current file for reference:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;Node to control the heading of the snake.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>License removed for brevity
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>rospy</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>geometry_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Twist</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PoseArray</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>std_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Float64</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>tf.transformations</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>euler_from_quaternion</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>SnakeHeadingController</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>object</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;&#34;&#34;Simple heading controller for the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>__init__</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>init_node</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake_heading_controller&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Publishers</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>twist_pub</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Publisher</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake/cmd_vel&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Twist</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>queue_size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Subscribers</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Subscriber</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake/pose&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PoseArray</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>pose_cb</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Subscriber</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;controller/heading&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Float64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_cb</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>spin</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>heading_cb</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>heading_msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;Callback for heading goal.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>orientation</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>pose_cb</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>pose_msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;Callback for poses from the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>quat</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>y</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>z</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>w</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#000>__</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>__</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>heading</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>euler_from_quaternion</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>quat</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;__main__&#34;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#000>SnakeHeadingController</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>You can run it again if you want, but there shouldn&rsquo;t be any difference from the
last time we ran it.</p><h3 id=implementing-the-controller>Implementing the Controller</h3><p>Now that everything is nicely laid out, let&rsquo;s get to the actual logic behind
the controller.</p><p>The first thing we want to do is figure out where the main loop is going to take
place. Since the pose callback is going to happen at a reasonably high rate, it
seems safe to put our code in there. If we wanted to be more careful, we could
look into using a <code>timer</code> or <code>rate</code> object.</p><p>In order to keep things simple, we&rsquo;re going to implement what is called a
<a href=https://en.wikipedia.org/wiki/Bang%E2%80%93bang_control>bang-bang controller</a>.
Essentially, it will output a fixed magnitude, positive or negative command
depending on the sign of the error. If we are too far left, it will shoot us
right. If we are too far right, it will shoot us left. If we wanted to be
fancier, we could look at something like a PID controller, but this will be
eaiser to implement and work just fine for our puproses.</p><p>On a basic level, our logic is going to look something like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>have_heading_command</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#000>error</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>heading</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>heading_command</span>
</span></span><span style=display:flex><span>    <span style=color:#000>angular_velocity</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>sign</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>ANGULAR_VELOCITY_MAG</span>
</span></span></code></pre></div><p>From this pseudocode, we know a few things:</p><ul><li>we need a variable to hold the magnitude of the angular velocity output</li><li>we need to get the heading command data from the other callback</li><li>we need a good way to subtract angles that can handle +/- pi being the same</li><li>we need a math library to copy the sign of the error</li></ul><p>Let&rsquo;s handle these in order:</p><p>First, we&rsquo;ll create an <code>ANGULAR_VELOCITY_MAG</code> variable. Put this line in the
<code>__init__</code> method after <code>init_node</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ANGULAR_VELOCITY_MAG</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2.0</span>
</span></span></code></pre></div><p>Next, we&rsquo;ll make a variable for tracking the heading command. Put this by the
previous line:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_command</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>None</span>
</span></span></code></pre></div><p>Update the heading callback to use this variable rather than a local variable:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_command</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>heading_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>data</span>
</span></span></code></pre></div><p>In order to handle the difference of angles, we&rsquo;ll use the <code>angles</code> module. Put
this line with your imports:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>angles</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>shortest_angular_distance</span>
</span></span></code></pre></div><p>In order to handle the sign of the error, we&rsquo;ll use the <code>math</code> module. Put this
line with your imports:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>math</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>copysign</span>
</span></span></code></pre></div><p>Now that we have all that out of the way, let&rsquo;s actually write the logic for the
loop. Modify the body of the pose callback to be the following:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_command</span> <span style=color:#204a87;font-weight:700>is</span> <span style=color:#204a87;font-weight:700>not</span> <span style=color:#204a87;font-weight:700>None</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>            <span style=color:#000>quat</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>y</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>z</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>w</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#000>__</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>__</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>heading</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>euler_from_quaternion</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>quat</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#000>error</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>shortest_angular_distance</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>heading</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_command</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#000>angular_velocity_command</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>copysign</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ANGULAR_VELOCITY</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>error</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>Here&rsquo;s the current file for reference:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;Node to control the heading of the snake.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>License removed for brevity
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Python</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>math</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>copysign</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>angles</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>shortest_angular_distance</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ROS</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>rospy</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>geometry_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Twist</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PoseArray</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>std_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Float64</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>tf.transformations</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>euler_from_quaternion</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>SnakeHeadingController</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>object</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;&#34;&#34;Simple heading controller for the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>__init__</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>init_node</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake_heading_controller&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_command</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>None</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ANGULAR_VELOCITY</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>6.28</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Publishers</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>twist_pub</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Publisher</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake/cmd_vel&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Twist</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>queue_size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Subscribers</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Subscriber</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake/pose&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PoseArray</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>pose_cb</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Subscriber</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;controller/heading&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Float64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_cb</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>spin</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>heading_cb</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>heading_msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;Callback for heading goal.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_command</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>heading_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>data</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>pose_cb</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>pose_msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;Callback for poses from the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_command</span> <span style=color:#204a87;font-weight:700>is</span> <span style=color:#204a87;font-weight:700>not</span> <span style=color:#204a87;font-weight:700>None</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>            <span style=color:#000>quat</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>y</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>z</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>w</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#000>__</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>__</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>heading</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>euler_from_quaternion</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>quat</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#000>error</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>shortest_angular_distance</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>heading</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_command</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#000>angular_velocity_command</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>copysign</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ANGULAR_VELOCITY</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>error</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;__main__&#34;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#000>SnakeHeadingController</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>We&rsquo;ll be able to test this shortly, but it isn&rsquo;t ready just yet.</p><h3 id=publishing-the-output>Publishing the Output</h3><p>Earlier we made a publisher and we wrote the logic to get the value to publish.
One of the last things we need is actually publishing the value.</p><p>Like we stated earlier, this node is going to use a constant value for the
linear velocity command for the snake. Let&rsquo;s define that constant now in the
<code>__init__</code> function:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>LINEAR_VELOCITY</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2.0</span>
</span></span></code></pre></div><p>Note that we are using all uppercase for our contants. This is just a convention
to make it easier for others to understand our code.</p><p>Now that we have the value, we can publish our ROS message. We&rsquo;ll construct a
new message of the correct type, populate our values, then publish it. This will
take place at the end of the pose callback (<code>pose_cb</code>).</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>            <span style=color:#000>twist_msg</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Twist</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>            <span style=color:#000>twist_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>linear</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>LINEAR_VELOCITY</span>
</span></span><span style=display:flex><span>            <span style=color:#000>twist_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>angular</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>z</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>angular_velocity_command</span>
</span></span><span style=display:flex><span>            <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>twist_pub</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>publish</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>twist_msg</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>Here&rsquo;s the current file for reference:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;Node to control the heading of the snake.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>License removed for brevity
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Python</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>math</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>copysign</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>angles</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>shortest_angular_distance</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ROS</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>rospy</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>geometry_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Twist</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PoseArray</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>std_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Float64</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>tf.transformations</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>euler_from_quaternion</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>SnakeHeadingController</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>object</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;&#34;&#34;Simple heading controller for the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>__init__</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>init_node</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake_heading_controller&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_command</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>None</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ANGULAR_VELOCITY</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>6.28</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>LINEAR_VELOCITY</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2.0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Publishers</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>twist_pub</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Publisher</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake/cmd_vel&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Twist</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>queue_size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Subscribers</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Subscriber</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake/pose&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PoseArray</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>pose_cb</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Subscriber</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;controller/heading&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Float64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_cb</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>spin</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>heading_cb</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>heading_msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;Callback for heading goal.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_command</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>heading_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>data</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>pose_cb</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>pose_msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;Callback for poses from the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_command</span> <span style=color:#204a87;font-weight:700>is</span> <span style=color:#204a87;font-weight:700>not</span> <span style=color:#204a87;font-weight:700>None</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>            <span style=color:#000>quat</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>y</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>z</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>w</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#000>__</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>__</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>heading</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>euler_from_quaternion</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>quat</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#000>error</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>shortest_angular_distance</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>heading</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_command</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#000>angular_velocity_command</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>copysign</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ANGULAR_VELOCITY</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>error</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#000>twist_msg</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Twist</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>            <span style=color:#000>twist_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>linear</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>LINEAR_VELOCITY</span>
</span></span><span style=display:flex><span>            <span style=color:#000>twist_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>angular</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>z</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>angular_velocity_command</span>
</span></span><span style=display:flex><span>            <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>twist_pub</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>publish</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>twist_msg</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;__main__&#34;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#000>SnakeHeadingController</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>We could go ahead and test this right now, but we&rsquo;re going to do a little bit of
finishing touches first.</p><h3 id=using-parameters>Using Parameters</h3><p>Currently, we have two contants in our code, <code>ANGULAR_VELOCITY</code> and
<code>LINEAR_VELOCITY</code>. If we want to change them, we would need to edit the Python
file for the node. That may be OK if we never expect these values to change,
but ROS actually has a method for handling parameters that let&rsquo;s you set them
the moment you launch a node. This can be useful if the parameters might need to
be different under different use cases, or it is a value you want the end user
to tune.</p><p>Replace our existing definitions of these variables with the below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ANGULAR_VELOCITY</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_param</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;~angular_velocity&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>6.28</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>LINEAR_VELOCITY</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_param</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;~linear_velocity&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2.0</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>Now, we are using <code>rospy</code> in order to get these parameters from a parameter
server. We&rsquo;ll talk about how to set those through ROS in just a minute. The name
of the parameter is the first argument, and the default value is the second.</p><p>Note the leading tilda, which makes these <em>local</em> parameters. In general, you
will always want to use local parameters. Also note that this needs to take
place <em>after</em> the call to <code>init_node</code>.</p><p>Here&rsquo;s the current file for reference:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;Node to control the heading of the snake.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>License removed for brevity
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Python</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>math</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>copysign</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>angles</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>shortest_angular_distance</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ROS</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>rospy</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>geometry_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Twist</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PoseArray</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>std_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Float64</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>tf.transformations</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>euler_from_quaternion</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>SnakeHeadingController</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>object</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;&#34;&#34;Simple heading controller for the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>__init__</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>init_node</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake_heading_controller&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_command</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>None</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ANGULAR_VELOCITY</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_param</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;~angular_velocity&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>6.28</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>LINEAR_VELOCITY</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_param</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;~linear_velocity&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2.0</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Publishers</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>twist_pub</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Publisher</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake/cmd_vel&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Twist</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>queue_size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Subscribers</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Subscriber</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake/pose&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PoseArray</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>pose_cb</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Subscriber</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;controller/heading&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Float64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_cb</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>spin</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>heading_cb</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>heading_msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;Callback for heading goal.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_command</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>heading_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>data</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>pose_cb</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>pose_msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;Callback for poses from the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_command</span> <span style=color:#204a87;font-weight:700>is</span> <span style=color:#204a87;font-weight:700>not</span> <span style=color:#204a87;font-weight:700>None</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>            <span style=color:#000>quat</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>y</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>z</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>w</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#000>__</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>__</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>heading</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>euler_from_quaternion</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>quat</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#000>error</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>shortest_angular_distance</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>heading</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_command</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#000>angular_velocity_command</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>copysign</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ANGULAR_VELOCITY</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>error</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#000>twist_msg</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Twist</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>            <span style=color:#000>twist_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>linear</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>LINEAR_VELOCITY</span>
</span></span><span style=display:flex><span>            <span style=color:#000>twist_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>angular</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>z</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>angular_velocity_command</span>
</span></span><span style=display:flex><span>            <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>twist_pub</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>publish</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>twist_msg</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;__main__&#34;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#000>SnakeHeadingController</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>Again, we could go ahead and test this script right now. However, we&rsquo;re going to
set something up to make that an easier process in the next step.</p><h3 id=creating-a-launch-file>Creating a Launch File</h3><p>Launching this program is somewhat involved. You need to start the ROS core in
one terminal window, then you need to launch this node in another. Can you
imagine how many terminal windows you would need for a large project? Thankfully,
ROS has a system to let you launch multiple nodes at once. It even let&rsquo;s you do
some fancy scripting to set parameters, launch nodes based off conditionals, and
nest files through include tags.</p><p>We need to create a new file inside the <code>launch</code> directory that we created
earlier. Let&rsquo;s name it <code>snake_controller.launch</code>.</p><p>Open this file up, and paste this in:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;launch&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;node</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;snake_heading_controller&#34;</span> <span style=color:#c4a000>pkg=</span><span style=color:#4e9a06>&#34;snake_controller&#34;</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;snake_heading_controller&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/launch&gt;</span>
</span></span></code></pre></div><p>This is an XML description (similar to HTML) of the ROS network we&rsquo;re going to
launch. You can see we put in the type of the node (the filename for Python
nodes), the package, and a name. The name can be anything we want, but it made
sense to repeat the name of the node type.</p><p>As we get more nodes, we&rsquo;ll put them in here too so that we can launch them all
at once.</p><p>Let&rsquo;s test our code now. Since we&rsquo;ve added new nodes since the last time we&rsquo;ve
built our package, we need to re-build our project. Run the following command
from anywhere inside your <code>catkin_ws</code> directory.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>catkin build
</span></span></code></pre></div><p>We also need to source the project. This let&rsquo;s the shell know what ROS programs
are available to call. If you&rsquo;ve added it to your bashrc (if you&rsquo;ve followed the
guide, you&rsquo;ve done this) you can run the below command from anywhere:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>source</span> ~/.bashrc
</span></span></code></pre></div><p>You only need to do that in any terminal windows that are currently open. Any
new ones will have that done automatically. You could also close and re-open
them all instead of running that command if you really wanted &mldr;</p><p>If you haven&rsquo;t added it to your bashrc, or just want to know how to source a
workspace manually, this is the command (from the <code>catkin_ws</code> directory):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>source</span> devel/setup.bash
</span></span></code></pre></div><p>Now, let&rsquo;s launch the code:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>roslaunch snake_controller snake_controller.launch
</span></span></code></pre></div><p>This isn&rsquo;t super exciting because it isn&rsquo;t recieving any input and isn&rsquo;t
connected to the snake game. We&rsquo;ll fix that shortly.</p><h3 id=extending-the-launch-file>Extending the Launch File</h3><p>You could launch the snake game in another shell with this command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>roslaunch snakesim snakesim.launch
</span></span></code></pre></div><p>Or you could launch both of them at once by creating a launch file that includes
both of them. Make a new launch file in the same directory as the last one
called <code>snake.launch</code>. This will be our primary launch file to get the whole
thing running.</p><p>Put the following lines in:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;launch&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;include</span> <span style=color:#c4a000>file=</span><span style=color:#4e9a06>&#34;$(find snakesim)/launch/snakesim.launch&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;include</span> <span style=color:#c4a000>file=</span><span style=color:#4e9a06>&#34;$(find snake_controller)/launch/snake_controller.launch&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/launch&gt;</span>
</span></span></code></pre></div><p>This file will call the <code>snakesim.launch</code> from that package, then call the
<code>snake_controller.launch</code> file that we just wrote. We can run it with the
below command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>roslaunch snake_controller snake.launch
</span></span></code></pre></div><p>You can also check that all the connections between the nodes are working by
visualizing it with rqt_graph. In a new terminal (with display capabilities),
run the following command.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rosrun rqt_graph rqt_graph
</span></span></code></pre></div><p>You should see a cool little diagram showing how your nodes are connected by
various topics.</p><h3 id=giving-the-heading-controller-input>Giving the Heading Controller Input</h3><p>Right now, it still isn&rsquo;t super exciting to run our node. The heading controller
isn&rsquo;t recieving any input so it isn&rsquo;t telling the snake to do anything. There
are a few ways we can fix this.</p><p>Let&rsquo;s look at a way to do it through the terminal, then we&rsquo;ll look at a way to
do it through a GUI.</p><p>You can manually publish ROS messages from the terminal using the <code>rostopic pub</code>
command. To give the snake a heading, you can run the following:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rostopic pub /controller/heading std_msgs/Float64 <span style=color:#4e9a06>&#34;data: 0.0&#34;</span>
</span></span></code></pre></div><p>You can see we need to specify the topic, the type, and the data. This will tab
complete, so that is cool. You can manually give the snake a few headings this
way and make sure the controller works. 0 corresponds to the right and it
increases counter-clockwise, measured in radians.</p><p>If you want a GUI to send messages, we can use a program called <code>rqt_publisher</code>.</p><p>Launch it with the following command on a terminal with display capabilites:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rosrun rqt_publisher rqt_publisher
</span></span></code></pre></div><p>You need to use a drop down to select the topic, then hit the plus to add it.
Then you need to hit a drop down arrow to be able to access the <code>data</code> field.
Once you have all that, hit the checkbox to start publishing. The controller
should behave the same way regardless of where the data is coming from.</p><h3 id=further-launch-file-notes>Further Launch File Notes</h3><p>This is a quick note about how to work with arguments and parameters. This is
super useful for creating a robust system of modular launch files. We won&rsquo;t go
super in depth, and it isn&rsquo;t needed for the tutorial. However, you might find it
useful to know.</p><p>Remember how we made our two constants ROS parameters? Let&rsquo;s say that we really
want to be able to make our snake&rsquo;s linear velocity an argument that we can
control by specifying a value when we run roslaunch. We want to be able to
do this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>roslaunch snake_controller snake.launch linear_velocity:<span style=color:#ce5c00;font-weight:700>=</span>5.0
</span></span></code></pre></div><p>The cool thing is that we can, and it isn&rsquo;t super difficult. First we need to
modify the <code>snake_controller.launch</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;launch&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;arg</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;linear_velocity&#34;</span> <span style=color:#c4a000>default=</span><span style=color:#4e9a06>&#34;2.0&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;node</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;snake_heading_controller&#34;</span> <span style=color:#c4a000>pkg=</span><span style=color:#4e9a06>&#34;snake_controller&#34;</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;snake_heading_controller&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;param</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;linear_velocity&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;$(arg linear_velocity)&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;/node&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/launch&gt;</span>
</span></span></code></pre></div><p>Here, we&rsquo;ve specified that we&rsquo;re expecting an argument called <code>linear_velocity</code>.
If we don&rsquo;t have anything explicitly set, we&rsquo;ll use a default value of 2.0. When
we start the <code>snake_heading_controller</code> node, we&rsquo;ll pass the value of our
argument to the node as a parameter.</p><p>Remember the distinction that arguments are for launch files, parameters are
for nodes.</p><p>If we try the above command, nothing different will happen? Why? Because we are
calling <code>snake.launch</code>, not <code>snake_controller.launch</code>. We need to set up a basic
pass through. Let&rsquo;s modify <code>snake.launch</code> to do that now:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;launch&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;arg</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;linear_velocity&#34;</span> <span style=color:#c4a000>default=</span><span style=color:#4e9a06>&#34;2.0&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;include</span> <span style=color:#c4a000>file=</span><span style=color:#4e9a06>&#34;$(find snakesim)/launch/snakesim.launch&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;include</span> <span style=color:#c4a000>file=</span><span style=color:#4e9a06>&#34;$(find snake_controller)/launch/snake_controller.launch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;arg</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;linear_velocity&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;$(arg linear_velocity)&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;/include&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/launch&gt;</span>
</span></span></code></pre></div><p>Now our above command will work :)</p><p>Note that you can have different default values at all the different levels. If
you want, make them all different and experiment with the speed of the snake
when you remove some of the new stuff that we just added.</p><p>If you&rsquo;re curious about what other shenanigans you can achieve with launch
files, the <a href=http://wiki.ros.org/roslaunch/XML>ROS wiki</a> has a full guide to
the syntax.</p><h3 id=final-notes-2>Final Notes</h3><p>Congratulations, you made it to the end! You just made your first ROS node to
build a controller for the snake. This node is relatively simple, but hopefully
you learned a lot about using ROS that will help you in creating the next two
nodes. Those next two tutorials are much faster since we got all the basic
groundwork taken care of in this one.</p><p>Below you&rsquo;ll see the final file we developed, plus a breakdown of it in case if
you forget what a specific section is doing. Feel free to experiment with making
changes to this node, or move on to the next one.</p><h3 id=full-file-for-reference>Full File for Reference:</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;Node to control the heading of the snake.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>License removed for brevity
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Python</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>math</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>copysign</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>angles</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>shortest_angular_distance</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ROS</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>rospy</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>geometry_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Twist</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PoseArray</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>std_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Float64</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>tf.transformations</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>euler_from_quaternion</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>SnakeHeadingController</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>object</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;&#34;&#34;Simple heading controller for the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>__init__</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>init_node</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake_heading_controller&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_command</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>None</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ANGULAR_VELOCITY</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_param</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;~angular_velocity&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>6.28</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>LINEAR_VELOCITY</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_param</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;~linear_velocity&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2.0</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Publishers</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>twist_pub</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Publisher</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake/cmd_vel&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Twist</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>queue_size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Subscribers</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Subscriber</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake/pose&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PoseArray</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>pose_cb</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Subscriber</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;controller/heading&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Float64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_cb</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>spin</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>heading_cb</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>heading_msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;Callback for heading goal.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_command</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>heading_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>data</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>pose_cb</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>pose_msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;Callback for poses from the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_command</span> <span style=color:#204a87;font-weight:700>is</span> <span style=color:#204a87;font-weight:700>not</span> <span style=color:#204a87;font-weight:700>None</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>            <span style=color:#000>quat</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>y</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>z</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>w</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#000>__</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>__</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>heading</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>euler_from_quaternion</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>quat</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#000>error</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>shortest_angular_distance</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>heading</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_command</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#000>angular_velocity_command</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>copysign</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ANGULAR_VELOCITY</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>error</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#000>twist_msg</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Twist</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>            <span style=color:#000>twist_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>linear</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>LINEAR_VELOCITY</span>
</span></span><span style=display:flex><span>            <span style=color:#000>twist_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>angular</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>z</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>angular_velocity_command</span>
</span></span><span style=display:flex><span>            <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>twist_pub</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>publish</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>twist_msg</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;__main__&#34;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#000>SnakeHeadingController</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><h3 id=full-file-broken-down>Full File Broken Down:</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/usr/bin/env python</span>
</span></span></code></pre></div><p>This is our shebang. It tells the command line how to execute our program.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;Node to control the heading of the snake.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>License removed for brevity
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;</span>
</span></span></code></pre></div><p>This is the docstring for the file. It gives a quick description and may also
include a license.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Python</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>math</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>copysign</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>angles</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>shortest_angular_distance</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ROS</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>rospy</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>geometry_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Twist</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PoseArray</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>std_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Float64</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>tf.transformations</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>euler_from_quaternion</span>
</span></span></code></pre></div><p>These are our import statements. They let us pull functionality from other
Python files. We&rsquo;ve split them into two groups for visual purposes / convention.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>SnakeHeadingController</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>object</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;&#34;&#34;Simple heading controller for the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>__init__</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>init_node</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake_heading_controller&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_command</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>None</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ANGULAR_VELOCITY</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_param</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;~angular_velocity&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>6.28</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>LINEAR_VELOCITY</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_param</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;~linear_velocity&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2.0</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Publishers</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>twist_pub</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Publisher</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake/cmd_vel&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Twist</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>queue_size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Subscribers</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Subscriber</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake/pose&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PoseArray</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>pose_cb</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Subscriber</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;controller/heading&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Float64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_cb</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>spin</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>This is the class definition for <code>SnakeHeadingController</code> and the <code>init</code> method.
The <code>init</code> method is run when a new <code>SnakeHeadingController</code> is made. It
initializes the node through ROS and gives it a name. The <code>heading_command</code>
variable is initialized as <code>None</code> so that we can distinguish between a lack of a
command and a command of 0. Two constants are created from ROS parameters, which
can be set in launch files or on the commandline.</p><p>The publishers and subscribers are created by specifying the topic and type. The
publisher also specifies a queue size and the subscribers specify a callback,
which is a function that gets called when a new message is received. A reference
to the publisher is retained so that we can publish to it in the future.</p><p>Lastly, we call <code>spin</code>. This command will block forever until the node is
shutdown. While it is blocking, the node responds to input by running the
callback methods for each new message it recieves.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>heading_cb</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>heading_msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;Callback for heading goal.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_command</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>heading_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>data</span>
</span></span></code></pre></div><p>This is our callback for heading commands. It has a short docstring, and we
simply save the data from the message so that we can retrieve it later.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>pose_cb</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>pose_msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;Callback for poses from the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_command</span> <span style=color:#204a87;font-weight:700>is</span> <span style=color:#204a87;font-weight:700>not</span> <span style=color:#204a87;font-weight:700>None</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>            <span style=color:#000>quat</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>y</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>z</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>orientation</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>w</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#000>__</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>__</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>heading</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>euler_from_quaternion</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>quat</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#000>error</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>shortest_angular_distance</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>heading</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_command</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#000>angular_velocity_command</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>copysign</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ANGULAR_VELOCITY</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>error</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#000>twist_msg</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Twist</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>            <span style=color:#000>twist_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>linear</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>LINEAR_VELOCITY</span>
</span></span><span style=display:flex><span>            <span style=color:#000>twist_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>angular</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>z</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>angular_velocity_command</span>
</span></span><span style=display:flex><span>            <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>twist_pub</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>publish</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>twist_msg</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>This is the callback for pose messages from the snake. We&rsquo;ve given it a nice
docstring and have a little check before running the main logic for the
controller. The orientation quaternion is converted into a yaw angle, we
calculate the error, then determine our control output. The control output is
wrapped up into a ROS message then published.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;__main__&#34;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#000>SnakeHeadingController</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>This is the section of our code that gets called first when we start the
program. We simply make a <code>SnakeheadingController</code> object, then let the
<code>__init__</code> method take over.</p><h2 id=position-controller>Position Controller</h2><h3 id=overview-2>Overview</h3><p>Our snake is now controlled by heading. Why don&rsquo;t we try to extend it another
layer and control with with position? That seems useful if we want to tell it
to chase the goal or give it a series of waypoints.</p><p>We&rsquo;ll create a closed loop controller like last time. Our inputs will be the
current position of the snake&rsquo;s head and the commanded position. Our output will
be the required heading to reach that positition.</p><h3 id=creating-the-program-1>Creating the Program</h3><p>This will be just like the last program. Let&rsquo;s call it
<code>snake_position_controller</code> and put it in the <code>nodes</code> folder like last time.
Make sure to make it executable!</p><p>Again, we&rsquo;ll start the program by writing a shebang and docstring. The basic
groundwork for the file will be really similar to last time too. See if you can
write out the <code>__main__</code> check, declare a class, and prototype all the methods
our class will need by writing a docstring then using <code>pass</code>.</p><p>You should have gotten something like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;Node to control the position of the snake.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>License removed for brevity
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>SnakePositionController</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>object</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;&#34;&#34;Simple position controller for the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>__init__</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>position_cb</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;Callback for position.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>snake_cb</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;Callback for poses from the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;__main__&#34;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#000>SnakePositionController</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><h3 id=ros-setup>ROS Setup</h3><p>This section will also be very similar to last time. We&rsquo;re going to initilize
the node, create our subscribers, and create our publishers. Take a look on the
ROS wiki, at both the <a href=http://wiki.ros.org/std_msgs>std_msgs</a> and
<a href=http://wiki.ros.org/geometry_msgs>geometry_msgs</a> packages and see if you can
pick out a good message type for the subscribers and publishers. Remember that
the message types need to match if we&rsquo;re recieving data from or sending data to
nodes that have already been written.</p><p>Once you&rsquo;ve got a handle on that, go ahead and write the <code>__init__</code> method. You
can also update the argument names in the callbacks to be more explicit. Don&rsquo;t
forget any imports too!</p><p>You should have gotten something like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;Node to control the position of the snake.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>License removed for brevity
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ROS</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>rospy</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>geometry_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>PoseArray</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Point</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>std_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Float64</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>SnakePositionController</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>object</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;&#34;&#34;Simple position controller for the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>__init__</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>init_node</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake_position_controller&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Publishers</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_pub</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Publisher</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;controller/heading&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Float64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>queue_size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Subscribers</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Subscriber</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake/pose&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PoseArray</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>snake_cb</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Subscriber</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;controller/position&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Point</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>position_cb</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>spin</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>position_cb</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>point_msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;Callback for position.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>snake_cb</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>pose_msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;Callback for poses from the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;__main__&#34;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#000>SnakePositionController</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>You can see the <code>Point</code> message was selected for the <code>controller/position</code>
topic. Other notable options were <code>Pose</code>, <code>Pose2D</code>, and time-stamped variants of
those messages (<code>PointStamped</code> and <code>PoseStamped</code>, there is no <code>Pose2DStamped</code>).
Since our goal is just a position and doesn&rsquo;t need any orientation data, we
won&rsquo;t use a Pose type. Additionally, Pose2D is depreciated and shouldn&rsquo;t be used
anyways. We could have time-stamped the message, but a timestamp isn&rsquo;t needed.
We&rsquo;ll always just chase the latest position command.</p><p>There are many other messages worth looking at on the <a href=http://wiki.ros.org/common_msgs>ROS wiki</a>
if you have a specific need in the future.</p><h3 id=implementing-the-controller-1>Implementing the Controller</h3><p>This controller can be implemented much like the last one. Create a variable to
track the desired position, then modify the positon callback in order to set it.</p><p>Try two write out the logic in the snake callback. You&rsquo;ll need a quick check,
then somehow you&rsquo;ll need to calculate the heading command. This can simply be
the heading from the point you are currently at, to the point you want to be at.
Once you have that, publish it as a ROS message. Don&rsquo;t forget any imports!</p><p>If you need a hint, the <code>atan2</code> function will help you out.</p><p>You should have come up with something like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;Node to control the position of the snake.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>License removed for brevity
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Python</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>math</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ROS</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>rospy</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>geometry_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>PoseArray</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Point</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>std_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Float64</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>SnakePositionController</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>object</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;&#34;&#34;Simple position controller for the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>__init__</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>init_node</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake_position_controller&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>position</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Publishers</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_pub</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Publisher</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;controller/heading&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Float64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>queue_size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Subscribers</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Subscriber</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake/pose&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PoseArray</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>snake_cb</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Subscriber</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;controller/position&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Point</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>position_cb</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>spin</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>position_cb</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>point_msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;Callback for position.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>position</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>point_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>point_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>y</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>snake_cb</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>pose_msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;Callback for poses from the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>position</span> <span style=color:#204a87;font-weight:700>is</span> <span style=color:#204a87;font-weight:700>not</span> <span style=color:#204a87;font-weight:700>None</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>            <span style=color:#000>pose</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>position</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>position</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>y</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8f5902;font-style:italic># make a local copy to avoid threading issues</span>
</span></span><span style=display:flex><span>            <span style=color:#000>position</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>position</span>
</span></span><span style=display:flex><span>            <span style=color:#000>heading</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>math</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>atan2</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>position</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>pose</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>position</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>pose</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>])</span>
</span></span><span style=display:flex><span>            <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_pub</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>publish</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>heading</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;__main__&#34;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#000>SnakePositionController</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>Something you&rsquo;ll notice is how a local copy of position is made. Look at these
two lines:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>            <span style=color:#8f5902;font-style:italic># make a local copy to avoid threading issues</span>
</span></span><span style=display:flex><span>            <span style=color:#000>position</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>position</span>
</span></span></code></pre></div><p>In rospy, the callbacks all happen in different threads. A thread is a separate,
simultaneously running, task. In Python, they aren&rsquo;t actually simultaneous, but
instead the computer will jump back and forth between different threads at a
high rate. A bytecode command, which is the smallest chunk that Python commands
can be split into can get interleaved between the two threads from it jumping
back and forth.</p><p>Essentially, you&rsquo;re not guaranteed that a callback will run all the way through
before a different callback will get started. If we were to remove the two lines
that were referenced earlier, it is possible that the call to <code>atan2</code> will be
started and the program will run a few bytecode commands in order to calculate
the value of the first argument. Then, the execution could go to a different
thread, where the first callback is being run. This could changes the
<code>self.position</code> tuple to a completely different number while the earlier thread
calculating the <code>atan2</code> is &lsquo;paused&rsquo;. Execution jumps back to the earlier thread
and keeps working on the <code>atan2</code> call. The second argument is now calculated
with the new point. When <code>atan2</code> is actually called, it would receive the Y
value from the first point, and the X value from the second. It would then be
calculating the heading to a location that isn&rsquo;t either of the two points we
wanted it to go to!</p><p>For this specific case, it wouldn&rsquo;t be a critical issue since it can&rsquo;t lead to a
program crash (as far as I know &mldr;). The pose callback would also be running
at a much higher rate than the position callback gets new data, so any weirdness
would be quickly fixed in the next iteration.</p><p>Regardless of how big an issue it could potentially be, it is still good to
write threadsafe code. This is discussed further in <strong>06_next-steps</strong>, along
with how making a local copy can resolves that issue. Making a local copy will
not always resolve the issue, but it does for this specific case. It also
discusses another technique to write threadsafe code using <code>Locks</code>.</p><h3 id=updating-launch-files-and-testing>Updating Launch Files and Testing</h3><p>Updating the launch file is relatively simple. Put this line in
<code>snake_controller.launch</code> right below the other node:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;node</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;snake_position_controller&#34;</span> <span style=color:#c4a000>pkg=</span><span style=color:#4e9a06>&#34;snake_tutorial&#34;</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;snake_position_controller&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><p>Running the code follows the same procedure as before. Make sure to <code>catkin
build</code> and source!</p><p>For testing, you can use either <code>rostopic pub</code> or <code>rqt_publisher</code>. See if you
can figure out the command for <code>rostopic pub</code>. Tab completion will be your
friend :)</p><h3 id=final-notes-3>Final Notes</h3><p>Congratulations, you just finished your second node and are almost done!
This tutorial was much more hands off, so hopefully you were able to apply a lot
of the knowledge you gained while writing the first node in order to write this
one.</p><p>Below, you&rsquo;ll see the final file we developed. Feel free to experiment with
making changes to this node, or move on to the next one.</p><h3 id=full-file-for-reference-1>Full File for Reference:</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;Node to control the position of the snake.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>License removed for brevity
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Python</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>math</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ROS</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>rospy</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>geometry_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>PoseArray</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Point</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>std_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Float64</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>SnakePositionController</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>object</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;&#34;&#34;Simple position controller for the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>__init__</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>init_node</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake_position_controller&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>position</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Publishers</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_pub</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Publisher</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;controller/heading&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Float64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>queue_size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Subscribers</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Subscriber</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake/pose&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PoseArray</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>snake_cb</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Subscriber</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;controller/position&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Point</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>position_cb</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>spin</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>position_cb</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>point_msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;Callback for position.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>position</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>point_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>point_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>y</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>snake_cb</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>pose_msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;Callback for poses from the snake.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>position</span> <span style=color:#204a87;font-weight:700>is</span> <span style=color:#204a87;font-weight:700>not</span> <span style=color:#204a87;font-weight:700>None</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>            <span style=color:#000>pose</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>position</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>pose_msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>poses</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>position</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>y</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8f5902;font-style:italic># make a local copy to avoid threading issues</span>
</span></span><span style=display:flex><span>            <span style=color:#000>position</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>position</span>
</span></span><span style=display:flex><span>            <span style=color:#000>heading</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>math</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>atan2</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>position</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>pose</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>position</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>pose</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>])</span>
</span></span><span style=display:flex><span>            <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heading_pub</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>publish</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>heading</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;__main__&#34;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#000>SnakePositionController</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><h2 id=goal-relay>Goal Relay</h2><h3 id=overview-3>Overview</h3><p>Our snake is now controlled by position. If we want to keep things really
simple, the snake can just chase the goal with no regard for walls or its own
body. You&rsquo;ll find it is pretty effective at the start of the game, but the
approach has some very clear flaws once the snake builds up any decent length.</p><p>This simple relay is what we&rsquo;ll develop now. In the future, you can expand on
this controller by fixing these problems. We&rsquo;ll give you a few more notes on
that in the next document.</p><h2 id=creating-the-program-2>Creating the Program</h2><p>This is going to start like the last program in creating the file and making it
executable, then adding the shebang and docstring. However, things are going to
be different once we start writing code. Go ahead and do all the above, and
write <code>pass</code> after the <code>__main__</code> check.</p><p>You should have something like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;Node to relay goal position to the position controller.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>License removed for brevity
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;__main__&#34;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>pass</span>
</span></span></code></pre></div><p>We <em>could</em> create a class like we&rsquo;ve done in the past. However, this node is
going to be <em>really</em> simple. We don&rsquo;t have any persistent data to keep track of
like commanded headings or positions. We&rsquo;ll also only have a single subscriber,
where we can put all of the logic. The logic won&rsquo;t even be anything spectacular.
It will simply be publishing the data from a PointStamped message as a Point
type. For something really small like this, it can be appropriate to skip over
creating a class, and put everything after the <code>__main__</code> check.</p><p>Look at the below program to see for yourself:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;Node to relay goal position to the position controller.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>License removed for brevity
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ROS</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>rospy</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>geometry_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>PointStamped</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Point</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;__main__&#34;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>init_node</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake_goal_relay&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># Publishers</span>
</span></span><span style=display:flex><span>    <span style=color:#000>goal_pub</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Publisher</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;controller/position&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Point</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>queue_size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># Subscribers</span>
</span></span><span style=display:flex><span>    <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Subscriber</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#39;snake/goal&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#000>PointStamped</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>lambda</span> <span style=color:#000>msg</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>pub</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>goal_pub</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>pub</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>publish</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>point</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>spin</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>We&rsquo;ve used something called a lambda in order to put the logic right into the
call to create a subscriber. Rather than include the name of a function, we used
the <code>lambda</code> keyword, which lets us put the arguments separated by commas, then
the logic after a semicolon. Note that you can also pass in extra arguments and
even assign them using an equal sign in the argument list.</p><p>You can learn more about lambdas <a href=https://www.w3schools.com/python/python_lambda.asp>online</a>.</p><h3 id=updating-launch-files-and-testing-1>Updating Launch Files and Testing</h3><p>Updating the launch file is no different from the position controller. Give it a
shot and see if the snake runs. Remember to <code>catkin build</code> and source!</p><p>You should have gotten something like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;node</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;snake_goal_relay&#34;</span> <span style=color:#c4a000>pkg=</span><span style=color:#4e9a06>&#34;snake_tutorial&#34;</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;snake_goal_controller&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><p>You will find you no longer need to manually plug in data in order to test.
Instead the snake controller is done, and will run automatically. Use <code>rqt_plot</code>
to see how all the nodes work together!</p><h3 id=final-notes-4>Final Notes</h3><p>Congratulations, you just finished writing a basic controller for the snake!
Hopefully you learned a great deal about how ROS works, and how to write nodes
in Python. You should be confident to experiment with your own ideas in to
improve upon (or completely rewrite!) the controller we&rsquo;ve just finished making.</p><p>Below, you&rsquo;ll see the final file we developed. Feel free to experiment with
making changes to this node, any of the previous ones, or start making your own.
There is some information to help you in the next document.</p><h3 id=full-file-for-reference-2>Full File for Reference:</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;Node to relay goal position to the position controller.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>License removed for brevity
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ROS</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>rospy</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>geometry_msgs.msg</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>PointStamped</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Point</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;__main__&#34;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>init_node</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;snake_goal_relay&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># Publishers</span>
</span></span><span style=display:flex><span>    <span style=color:#000>goal_pub</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Publisher</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;controller/position&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Point</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>queue_size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># Subscribers</span>
</span></span><span style=display:flex><span>    <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Subscriber</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#39;snake/goal&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#000>PointStamped</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>lambda</span> <span style=color:#000>msg</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>pub</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>goal_pub</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>pub</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>publish</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>point</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>rospy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>spin</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><h2 id=next-steps>Next Steps</h2><h3 id=overview-4>Overview</h3><p>You did it. You finished the guided tutorials. You likely learned a lot about
ROS and Python along the way. Hopefully you take some pride in your accomplishment because learning to use ROS is no easy feat.</p><p>In this document, we&rsquo;ll present some ideas on how you could improve upon this
controller in order to expand on your ROS knowledge. We&rsquo;ll also give you some
tips and insight into additional topics you may encounter while working on your
improvements.</p><h3 id=ideas-for-improvement>Ideas for Improvement</h3><p>Feel free to use some of these ideas in the list, or go off and do your own
thing. This is designed to be open ended. You can build on the existing
controller or tear it down completely to make your own system.</p><h4 id=self-avoidance-system>Self Avoidance System</h4><p>The snake dies when it intersects with itself. You could create a new node to
sit between the goal relay and the position controller that will re-route the
snake if it is detecting a collision.</p><p>You could also remove the goal relay completely and design your own waypoint
controller that uses an graph based planning algorithm. For example, grassfire,
Dijkstra, or A* (pronouced &ldquo;A star&rdquo;) algorithms could all work.</p><p>If you want to get really fancy, you could consider the fact that the snake is
going to move as you execute the motion plan, so it may be acceptible to
intersect with the current position by some amount. Cutting corners like this
may save you valuable time if you&rsquo;re trying to maximize the score in a fixed
time frame.</p><h4 id=wall-avoidance-system>Wall Avoidance System</h4><p>Another way that the snake dies is by intersecting with the wall. Commonly, this
is an issue when the snake approaches a goal near the wall in a way that doesn&rsquo;t
leave room for the snake to get out.</p><p>Like the above suggestion, you could create a new node between the goal relay
and position controller that re-routes the snake to a safe path. You could
also remove it completely and build it right into a fancier waypoint controller.</p><p>This could be built in addition to the self avoidance system using some sort of
planning algorithm that looks past reaching the next goal. For example Rapidly
Exploring Random Trees (RRT) could be used to find a safe path to the goal and
an arbitray secondary location nearby.</p><h4 id=machine-learning>Machine Learning</h4><p>If you have experience with machine learning, you can probably apply it to this
problem. If you want GPU acceleration, take a look at modifying the Docker
scripts to use the <a href=https://github.com/NVIDIA/nvidia-docker>NVIDIA Container Toolkit</a>.
You may also run into issues with Python versions. There is a way to run ROS
with Python 3, but it requires a little bit of extra work. You can also develop
a multicontainer application and use Docker&rsquo;s networking tools to bridge between
this container and another running your machine learning stack. These are all
more advanced topics so we won&rsquo;t discuss how to do that in this document.</p><h2 id=tips-and-insights-for-making-new-nodes>Tips and Insights for Making New Nodes</h2><h3 id=portability>Portability</h3><p>Beginners sometimes like to put all the logic for a system in one big node. This
is like if we put the heading, position, and goal relay nodes all in one place.
Technically, it will work fine with ROS if you have all your inputs and ouputs
set up correctly. However, it may not be the <em>best</em> way to do things.</p><p>A really big benefit of ROS is how modular a system of nodes can be. Let&rsquo;s say
that you want to experiment with using a more intelligent waypoint controller
rather than just feeding in the goal position. You can write a new node for that
purpose and create a different launch file to use it. You could even make the
launch file pick the correct node programatically using commandline arguments!</p><p>It can also be advantagous to split things up for debugging purposes. If we put
all the logic for the controller in once node, then started having issues with
the heading control to the system, we&rsquo;d need to go in and put print statements
or use a debugger in order to check the output. With the way we wrote it with
ROS, we can use commandline tools like <code>rostopic echo</code> in order to validate the
output. We could also isolate the one node we want to verify and perform unit
testing using <code>rostopic pub</code>.</p><p>Lastly, using ROS messages defines a command standard for nodes to communicate.
If you put everything in one big node, you probably will use internal Python
data structures to send information back and forth. This may make things more
difficult to maintain later on if you don&rsquo;t define these interfaces very
clearly.</p><p>As a general rule of thumb, split up logic into multiple nodes if:</p><ul><li>there are multiple logical steps that may be re-used or replaced in the future</li><li>you want to be able to debug data sent between two logical steps using ROS</li><li>The data sent between multiple logical steps has a complex format that a ROS
message exists for</li></ul><h3 id=naming-conventions>Naming Conventions</h3><p>Here is the general rule of thumb for naming ROS specific items:</p><ul><li>packages: <code>snake_case</code></li><li>nodes: <code>snake_case</code></li><li>topics: <code>snake_case/with/optional/nesting</code></li><li>parameters: <code>snake_case/with/optional/nesting</code></li></ul><p>For Python, follow the <a href=https://www.python.org/dev/peps/pep-0008/>PEP 8 guidelines</a>:</p><ul><li>classes: <code>PascalCase</code></li><li>variables: <code>snake_case</code></li><li>&ldquo;private&rdquo; variables: <code>_snake_case_with_leading_underscore</code></li><li>&ldquo;constant&rdquo; variables: <code>CAPITALIZED_WITH_UNDERSCORES</code></li><li>functions: <code>snake_case</code></li><li>&ldquo;private&rdquo; functions: <code>_snake_case_with_leading_underscore</code></li></ul><h3 id=picking-message-types>Picking Message Types</h3><p>Generally, you want to use a ROS message type that is intended for the
application you have in mind. For example, the <code>Vector3</code> message and the <code>Point</code>
message both have three fields, <code>x</code>, <code>y</code>, and <code>z</code>. However, <code>Vector3</code> is
designed to represent vectors in 3D space, while <code>Point</code> is designed to
represent points in 3D space.</p><p>Another bad thing is to use a message and use the fields for different purposes
than intended. For example, ROS has a <code>Quaternion</code> message, but no standard
<code>EulerAngle</code> message. If you took a <code>Quaternion</code> message and made the <code>x</code>,<code>y</code>,
and <code>z</code> field correspond to roll, pitch, and yaw, that would be really confusing
for future users. It is also generally advisable to use quaternions over Euler
angles since there is no confusion about how to interpret them.</p><p>ROS has some standard message types that you can look at online:</p><ul><li><a href=http://wiki.ros.org/std_msgs>std_msgs</a></li><li><a href=http://wiki.ros.org/common_msgs>common_msgs</a></li></ul><p>If you feel really adventurous, you can define your own messages, but that is
outside the scope of this document.</p><h3 id=threading-notes>Threading Notes</h3><p>Earlier, we discussed that for rospy, all of the subscriptions happen in their
own threads. This can be an issue if you have code like the following:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>callback_one</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>important_variable</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>data</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>callback_two</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># Check that we can take the log of important_variable</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>important_variable</span> <span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>some_variable</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>data</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>math</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>important_variable</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>What <em>could</em> happen is that <code>callback_two</code> gets called and performs the check.
Then <code>callback_one</code> gets called and sets <code>important_variable</code> to a negative
number. Then, the execution goes back to <code>callback_two</code> and we crash the
program since <code>math.log</code> throws an error if you try to take the natural
logarithm of a negative number.</p><p>You could also have issues with something like iterating through an array if
the array is being changed in a different callback.</p><p>There are a few ways to get around this:</p><ul><li>use locks</li><li>use atomic operations</li></ul><h4 id=locks>Locks</h4><p>Locks (similar to mutex&rsquo;s in other langues) let you enforce rules about how
threads can access shared data. Let&rsquo;s see what the earlier example looks like
when lock are being used:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>threading</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ...</span>
</span></span><span style=display:flex><span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>lock</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>threading</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Lock</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>callback_one</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>lock</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>acquire</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>    <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>important_variable</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>data</span>
</span></span><span style=display:flex><span>    <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>lock</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>release</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>callback_two</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>msg</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>lock</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>acquire</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># Check that we can take the log of important_variable</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>important_variable</span> <span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>some_variable</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>data</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>math</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>important_variable</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>lock</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>release</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>This works because one callback can&rsquo;t acquire the lock until the other has
released it. It is a blocking call by default. Locks are provided through the
<code>threading</code> library, and you can read more about them
<a href=https://docs.python.org/2/library/threading.html#lock-objects>online</a>.</p><h4 id=atomic-operations>Atomic Operations</h4><p>This is a more advanced concept, but it can make things a little bit simpler if
you understand it well.</p><p>In CPython atleast, there is something called the Global Interpreter Lock or
GIL. This essentially makes a restriction that multithreaded programs can really
only run in a single thread. Instead it switches back and forth between running
bytecode commands from the different &ldquo;threads&rdquo;. The benefit is that if you know
a certain command is atomic (meaning it is one bytecode instruction), you don&rsquo;t
need to worry about breaking things as much.</p><p>This is why it was safe in the <code>snake_position_controller</code> node to make a local
copy. Making a local copy of a tuple is atomic. Tuples are immutable, meaning
that when it is updated in another thread, a new one is made, the variable is
changed to point to the new one, and the old one is thrown out if nothing else
is still using it. For our case, we were still using it with our local variable,
so it was kept safe for us. Lists are a good example of a datatype that is not
immutable. If our X and Y values had been stored in a list, we would not have
been thread safe.</p><p>A full list of atomic operations are proved <a href=https://docs.python.org/2/faq/library.html#what-kinds-of-global-value-mutation-are-thread-safe>online</a>.</p><h3 id=debugging>Debugging</h3><p>There are going to be many times where ROS wants to make you slam your head into a wall.
Luckily there are tools to reduce that frustration and help spot issues.</p><p>This is a short list of the many options avaliable:</p><ul><li><p><a href=http://wiki.ros.org/rqt_graph>rqt_graph</a>: This ROS package allows users to
visualize the ROS computation graph. In other words, you can see what nodes
are active as well as
how nodes are communicating. Here is an example of a graph:
<img src=assets/images/rqt-example.png alt="rqt graph example"></p></li><li><p><a href=http://wiki.ros.org/roswtf>roswtf</a>: This ROS package is an automated
debugging tool that finds issues by searching your workspace and graph. It can
find things like improperly set up packages and nodes with unconnected topics.
Additionally it has a fun name.</p></li><li><p><a href=http://wiki.ros.org/rostopic>rostopic</a>: This command-line tool can be used
in debugging nodes by the messages sent on connected topics. The main commands
you might find most useful are <code>list</code>, <code>echo</code> and <code>pub</code>. <code>list</code> will list all
active topics on the ROS graph. <code>echo</code> will let you monitor a topic live on the
commandline. <code>pub</code> will let you send messages via the command line. This tool is
espcially helpful for testing or when running nodes independently.</p></li><li><p><a href=http://wiki.ros.org/rosnode>rosnode</a>: This is another useful command-line
tool for debugging nodes. You can use <code>list</code> to see all active nodes, then
<code>info</code> to print out various information about a given node.</p></li><li><p><a href=https://docs.python.org/3/library/pdb.html>Python Specific Debugger (PDB)</a>:
This is a tool built to help debug python applications. It has nothing to do
with ROS. It has a bit of a learning curve, but it was used heavily in making
the <code>snakesim</code> package. It may be worth using if you think you have issues
inside of a node that you can&rsquo;t debug by looking at ROS messages going in and
out. It will allow you to step through your code using breakpoints, and monitor
the value of variables as you do so.</p></li></ul><h2 id=additional-resources-and-getting-help>Additional Resources and Getting Help</h2><p>If you&rsquo;re part of the Autonomous Robotics Club of Purdue, you can post questions
to other members on Slack. This is a really good way to get quick feedback.</p><p>If you&rsquo;re looking for other resources online, there are a few official ones:</p><ul><li><a href=http://wiki.ros.org/>ROS Wiki</a></li><li><a href=https://answers.ros.org/questions/>ROS Answers</a></li><li><a href=https://discourse.ros.org/>ROS Discourse</a></li></ul><p>And of course, there are always other forum sites like <a href=https://stackoverflow.com/>StackOverflow</a>.
You can also find resources on YouTube that may help with the explanation of
general concepts.</p><p>If you&rsquo;re looking for a textbook like experience, there is an excellent free
book called <a href=https://www.cse.sc.edu/~jokane/agitr/agitr-letter.pdf>A Gentle Introduction to ROS</a>.</p><h2 id=give-us-feedback>Give Us Feedback</h2><p>Feel free to give us feedback on this tutorial. If you are part of the
Autonomous Robotics Club of Purdue, let us know about any potential improvements
or errors you found through Slack. If you have an interest in creating your own
tutorial to add to this package, lets us know.</p><p>If you&rsquo;re outside of the club and found this useful, please let us know. You can
give the repo some stars on <a href=https://github.com/purdue-arc/arc_tutorials>GitHub</a>.
You can also create GitHub Issues for any problems you found, or open up a PR if
you have a fix. If you want to get in contact with the maintainer, send us an
email through <a href=mailto:autonomy@purdue.edu>autonomy@purdue.edu</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-ecf70efeaa595e788a277309f4a76a9d>4 - Using the Terminal</h1><div class=lead>Tutorial on the basic features of Bash</div><h2 id=prerequisites>Prerequisites</h2><p>If you are using Windows, you&rsquo;ll want to install <a href=/wiki/tutorials/wsl2>WSL2</a> to follow along.</p><h2 id=introduction>Introduction</h2><p>The terminal is an interface for interacting with your computer. While traditional applications are intuitive, they can hold you back from accomplishing complicated tasks.</p><p>The terminal is itself an interface to a shell on the system, which handles command execution and other nice features such as piping. Most Linux systems come packaged with BASH (Bourne Again SHell).</p><h2 id=basic-commands>Basic commands</h2><p>Early on, you&rsquo;ll want to memorize a small subset of commands that can handle a majority of tasks.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ <span style=color:#204a87>pwd</span>
</span></span></code></pre></div><p>This stands for &lsquo;print working directory&rsquo;, which as you can guess, prints the directory you are currently in. The shell automatically provides you with a location within your computer&rsquo;s file system. This can change the outcome of certain commands as we&rsquo;ll see.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ls
</span></span></code></pre></div><p>This is short for &rsquo;list&rsquo;. It will print all of files in your working directory. If you modify the command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ls -a
</span></span></code></pre></div><p>It will print all files (including hidden ones).</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> &lt;folder&gt;
</span></span></code></pre></div><p>This means &lsquo;change directory&rsquo;. It allows you to modify your working directory. You can specify the <code>&lt;folder></code> argument in a variety of ways. If the folder you want to move into is contained within the current working directory, then you can specify a relative path using a period:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ./relative-directory
</span></span></code></pre></div><p>Similarly, if the folder is contained within your home directory, then you can use the tilde key:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ~/directory-in-home
</span></span></code></pre></div><p>Sometimes it is also useful to specify parent directories, which is done using sequential periods:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ../
</span></span></code></pre></div><p>This will change the working directory to the parent of the current working directory. You can chain this shortcut to move multiple levels:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> ../../
</span></span></code></pre></div><h2 id=going-forward>Going forward</h2><p>Purdue&rsquo;s USB has a <a href=https://purdueusb.com//wiki/terminal-cheatsheet>cheatsheet</a> with some additional information.</p><p>It&rsquo;s recommended you also explore shell text editors (such as <a href=https://www.vim.org/>vim</a>) and version control systems (like <a href=https://git-scm.com/>git</a>).</p></div><div class=td-content style=page-break-before:always><h1 id=pg-a1452db62844d68fbce1e24f7db842cf>5 - X Forwarding</h1><div class=lead>Tutorial on forwarding remote graphical interfaces to your local machine</div><h2 id=prerequisites>Prerequisites</h2><p>Before starting this tutorial, we recommend:</p><ul><li><a href=/wiki/tutorials/terminal>Familiarity with using the terminal</a></li></ul><h2 id=introduction>Introduction</h2><p>X forwarding is what will let you display GUIs (graphical user interfaces)
on your machine that are being run from your Docker container. You need
to install an X client, set up the appropriate firewall rules, then tell Docker
to forward its display to your client.</p><h2 id=instructions-by-os>Instructions by OS</h2><p>X forwarding configuration varies by machine, so follow the steps that match your operating system. If you run into any issues or don&rsquo;t have a supported OS, reach out in the comments below.</p><h3 id=windows-10--11>Windows 10 / 11</h3><p><strong>X Client Set Up</strong></p><p>There are several options available here. VcXsrv has been tested to work with
the ARC development environment and is available on <a href=https://sourceforge.net/projects/vcxsrv/>SourceForge</a>.
VcXsrv is the recommended client.</p><p>If you install VcXsrv, launch it with the <code>XLaunch.exe</code> executable, not <code>VcXsrv.exe</code>.
When you launch it for the first time, you will see several configuration pages.
You may leave them all at the default: multiple windows, no clients.</p><p><strong>Windows Firewall Setup</strong></p><p>When you first launch your X client, you should see Windows Firwall pop up. Go
ahead with the default settings.</p><p>Now that everything is blocked, we need to put in an exception so that our WSL2
instance is able to access the X client.</p><p>These instructions are taken from a <a href=https://www.reddit.com/r/Windows10/comments/gd7n5z/how_do_i_convince_windows_10_that_a_vethernet/>Reddit post</a></p><ol><li>Launch Windows Firewall. Simply search &ldquo;Firewall&rdquo; in the Start Menu</li><li><a href=https://i.imgur.com/oo9L3pH.png>Go to properties</a></li><li><a href=https://i.imgur.com/ZbSjO8k.png>Go to &ldquo;Public Profile</a></li><li><a href=https://i.imgur.com/1rOprzr.png>Select &ldquo;Customize&rdquo;</a></li><li><a href=https://i.imgur.com/9ZaWc3S.png>Uncheck the &ldquo;(WSL)&rdquo; option</a></li></ol><p>Go ahead and save and close everything. You may need to reboot your X client.</p><p><strong>WSL2 Setup</strong></p><p>We will need to edit a file called the <code>bashrc</code>. This is a script that is run
every time you open a new terminal in order to set up your environment. Modify
it by copy and pasting the below command in <em>exactly</em>. Run these commands in
WLS2, not Powershell or Windows Commandline. From now on, all commands to be
listed like this should be put into the WSL2 commandline.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>echo</span> -e <span style=color:#4e9a06>&#39;\nexport DISPLAY=$(awk &#39;</span><span style=color:#4e9a06>\&#39;</span><span style=color:#4e9a06>&#39;/nameserver / {print $2; exit}&#39;</span><span style=color:#4e9a06>\&#39;</span><span style=color:#4e9a06>&#39; /etc/resolv.conf 2&gt;/dev/null):0\nexport LIBGL_ALWAYS_INDIRECT=1&#39;</span> &gt;&gt; ~/.bashrc
</span></span></code></pre></div><p>Since we just changed our <code>bashrc</code>, we need to run the below command for the
changes to take effect in our current terminal:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>source</span> ~/.bashrc
</span></span></code></pre></div><p><strong>Testing</strong></p><p>You will need to download a small program called <code>xeyes</code> in order to test the X
forwarding. It can be installed and run with the following commands:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install -y x11-apps
</span></span><span style=display:flex><span>xeyes
</span></span></code></pre></div><p>You&rsquo;ll see a little pair of eyes follow your cursor around. You can X out of it
or hit <code>CTRL+C</code> in order to kill the program.</p><h3 id=mac>Mac</h3><p><strong>X Client Set Up</strong></p><p>The most widely used X client for Mac is X Quartz. You can install it <a href=https://www.xquartz.org/>here</a>.</p><p><strong>Configure X Quartz</strong></p><p>You need to first allow connections from network clients:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>defaults write org.macosforge.xquartz.X11.plist nolisten_tcp <span style=color:#0000cf;font-weight:700>0</span>
</span></span></code></pre></div><p>Now run the following command to allow localhost access on startup:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;export DISPLAY=host.docker.internal:0 \nxhost + 127.0.0.1&#39;</span> &gt;&gt; ~/.zshrc
</span></span></code></pre></div><p>After running the above command, restart your system.</p><p><strong>Errors with running X Quartx</strong></p><p>If you have errors while completing the above steps, take a look at the following <a href=mac-errors>trouble shooting guide</a>.</p><p><strong>Testing</strong></p><p>You will need to download a small program called <code>xeyes</code> in order to test the X
forwarding. It can be installed and run with the following commands:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install -y x11-apps
</span></span><span style=display:flex><span>xeyes
</span></span></code></pre></div><p>You&rsquo;ll see a little pair of eyes follow your cursor around. You can X out of it
or hit <code>CTRL+C</code> in order to kill the program.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-956c2caed651ad5914da7f6d7c2ff6fe>6 - ROS</h1><div class=lead>Tutorial on robot operating system</div><h2 id=prerequisites>Prerequisites</h2><p>Before starting this tutorial, we recommend:</p><ul><li><a href=/wiki/tutorials/terminal>Familiarity with using the terminal</a></li><li><a href=https://wiki.python.org/moin/BeginnersGuide/Programmers>An understanding of Python</a></li></ul><h2 id=what-is-ros>What is ROS?</h2><p>ROS stands for Robot Operating System. It is an industry standard tool for creating autonomous robots. Essentially, it is a framework to create a mesh of nodes that work together to control your robot. It has an API for both C++ and Python. Through it, you have a common language to define messages that are sent from one node to another (for example a path planning node can send waypoint messages to a low level control node). The beauty of it is that all the nodes can be modular and developed independently if you have a well defined interface of messages.</p><p>Another really excellent reason to use ROS is the 5000+ number of existing packages that can act as ‘plug and play’ into your existing network. If you have a new sensor you’re looking to try, someone has probably already written a ROS driver for it. Tasks such as mapping, perception, and state estimation that many robots need to do probably have multiple packages that you can experiment with and pick the best one for your specific application. There are also pre-defined messages for standard things like sensor data and control commands. For these reasons it can be really useful for jump-starting a new project.</p><p>Through this club, you will be learning much more about ROS. The snake_tutorial package will walk you through creating a few simple nodes that can be chained together to control a snake to reach a goal. You will also have the opportunity to expand on the very basic controller given to you in an open ended challenge to create the highest performing AI for the snake.</p><p>A downside of ROS is that it works really well on Ubuntu, but isn’t well supported on other operating systems. This is why we must set up a very specific development environment for the club.</p><p>For more information on ROS, check out their wiki: <a href=http://wiki.ros.org/ROS/Introduction>http://wiki.ros.org/ROS/Introduction</a></p><h2 id=setup--installation>Setup / Installation</h2><p>A development environment (DE) is a suite of tools used to streamline writing, running, and testing code.</p><p>To simplify the installation and setup process for using ROS, ARC has created a standard DE that we recommend for all members.</p><p>ARC&rsquo;s DE relies on a program known as Docker. This program virtualizes various operating systems and dependencies to ensure your software is compatible to run on any device you choose to use.</p><blockquote><p>ARC use to fully support another DE using Construct. If Docker fails to work on your machine, you can explore <a href=alt-ros>this method</a> as an alternative.</p></blockquote><p>If you have ever worked with a virtual machine, it&rsquo;s the same concept but avoids a bunch of uncecessary programs and overhead.</p><p>&lsquo;Images&rsquo; in Docker can be thought of as blueprints for a computer to be virtualized. ARC has created a generic image with all the required dependencies for ROS. When working on a ROS project, you will run a &lsquo;container&rsquo;, which is just a single instance of ARC&rsquo;s image. All of this is managed by boilerplate scripts that you just need to include in your project.</p><blockquote><p>To learn more about how Docker works internally, check <a href=https://docs.docker.com/engine/>their documentation</a>.</p></blockquote><p>ARC&rsquo;s image uses Ubuntu 20.04 with ROS Noetic installed. It also has a few other handy tools, such as zsh.</p><p>The rest of this section will detail the setup process for ARC&rsquo;s DE.</p><h3 id=docker-installation>Docker Installation</h3><p>Follow <a href=https://docs.docker.com/engine/install/>this installation guide</a> to get Docker for your specific OS.</p><h3 id=instructions-by-os>Instructions by OS</h3><p>See the below instructions depending on what operating system you are running.</p><h4 id=windows>Windows</h4><blockquote><p>This guide was tested on Windows 10 and 11, if you are using a prior version you will need to upgrade or consider dual-booting.</p></blockquote><p>To use ARC&rsquo;s DE on Windows, you will need WSL2. We have a seperate tutorial for this, which you can follow <a href=wsl2>here</a>.</p><p>You then need to setup X forwarding. This allows you to display GUIs (graphical user interfaces) from your WSL2 instance on your Windows machine. Again we have a seperate tutorial for this, which you can follow <a href=x-forwarding>here</a>.</p><h4 id=mac>Mac</h4><p>Presently, this guide has not been fully tested on a Mac system. In theory it should because there is a version of Docker for Mac, but some additional work is required to get all features to function. If you&rsquo;re interested in running this on Mac, understand that some experimentation may be required.</p><p>You need to setup X forwarding. This allows you to display GUIs (graphical user interfaces) from your Docker instance on your machine. We have a seperate tutorial for this, which you can follow <a href=x-forwarding>here</a>.</p><h4 id=linux>Linux</h4><p>This guide has been tested to work on Ubuntu 18.04 and 20.04. If you have a different distribution, it should also work without issue.</p><h3 id=testing>Testing</h3><p>To ensure that everything works, follow the process below.</p><blockquote><p>You don&rsquo;t have to understand what all of these commands do yet, this will be explained with more depth in future sections. If any of these commands return an error, take a moment to try and independently debug. If after 5 minutes you have no luck, reach out in the comments and somebody can assist.</p></blockquote><p>Move to your home directory:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span>
</span></span></code></pre></div><p>Setup a catkin workspace:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p catkin_ws/src
</span></span></code></pre></div><p>Move into the source code folder:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> catkin_ws/src
</span></span></code></pre></div><p>Clone the ARC tutorials package:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone git@github.com:purdue-arc/arc_tutorials.git
</span></span></code></pre></div><p>Build the docker image:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./arc_tutorials/docker/docker-build.sh
</span></span></code></pre></div><p>Run the docker container:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./arc_tutorials/docker/docker-run.sh
</span></span></code></pre></div><p>Your terminal should now show a new prompt indicating that you are within the docker container. This is a new environment where all of the ROS dependencies have been installed.</p><p>Again move into the catkin workspace:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> catkin_ws
</span></span></code></pre></div><p>Build the <code>arc_tutorial</code> package:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>catkin build
</span></span></code></pre></div><p>Update your environment with the newest build:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>source</span> devel/setup.bash
</span></span></code></pre></div><p>Lastly launch snake game:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>roslaunch snakesim snakesim.launch
</span></span></code></pre></div><p>Upon running this, two windows should appear:</p><p><img src=assets/images/snake-sim.PNG alt="Snake Sim">
<img src=assets/images/snake-sim-control-board.PNG alt="Snake control"></p><p>If these windows don&rsquo;t appear, but every other command ran fine, then X forwarding is likely not working. Review the <a href=/wiki/tutorials/x-forwarding>X forwarding</a> tutorial and if nothing works, then reach out in the comments.</p><p>If they did appear however, then your dev environment is fully working!</p><h2 id=learning-the-basics>Learning the Basics</h2><p>You now have a basic idea of what ROS is and can run it on your machine. It&rsquo;s time to learn the basics of what it offers.</p><p>The environment you tested in the last section will serve as a simple platform to study ROS.</p><p>Check out the <a href=https://youtu.be/q9RCP4lizNM>video we made to introduce this section of the tutorial</a>.</p><p>After watching the above video, you can move on to the <a href=/wiki/tutorials/snake-game>walkthrough</a>.</p><h2 id=moving-forward>Moving Forward</h2><p>Congrats! You are one step closer to world domination. While you can learn more about ROS in <a href=http://wiki.ros.org/ROS/Tutorials>their tutorials</a>, we recommend diving in through one of the club projects.</p></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel=noopener href=https://mobile.twitter.com/purduerobotics aria-label=Twitter><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/purdue-arc aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Discord aria-label=Discord><a class=text-white target=_blank rel=noopener href=https://discord.gg/ddkzfD2cyu aria-label=Discord><i class="fab fa-discord"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2023 Purdue ARC All Rights Reserved</small>
<small class=ml-1><a href=https://policies.google.com/privacy target=_blank rel=noopener>Privacy Policy</a></small></div></div></div></footer></div><script src=/js/main.min.7cefd0b4fd701d2ed63770cd335a32296fb92d97c9b825c65fb3f7853e5a22b9.js integrity="sha256-fO/QtP1wHS7WN3DNM1oyKW+5LZfJuCXGX7P3hT5aIrk=" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script></body></html>